<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>DANL 320 | Linear Regression w/ PySpark – About</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">About</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../personal_blog.html"> 
<span class="menu-text">Personal Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../danl_310.html"> 
<span class="menu-text">DANL310</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../danl_320.html"> 
<span class="menu-text">DANL320</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../dashboard.html"> 
<span class="menu-text">DANL 310 Dashboard</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#importing-modules-reading" id="toc-importing-modules-reading" class="nav-link active" data-scroll-target="#importing-modules-reading">Importing Modules &amp; Reading</a></li>
  <li><a href="#univariate-linear-regression-w-pyspark" id="toc-univariate-linear-regression-w-pyspark" class="nav-link" data-scroll-target="#univariate-linear-regression-w-pyspark">Univariate Linear Regression w/ PySpark</a>
  <ul class="collapse">
  <li><a href="#splitting-data-into-train-and-test-sets" id="toc-splitting-data-into-train-and-test-sets" class="nav-link" data-scroll-target="#splitting-data-into-train-and-test-sets">Splitting Data into Train and Test Sets</a></li>
  <li><a href="#building-ml-df-using-vectorassembler" id="toc-building-ml-df-using-vectorassembler" class="nav-link" data-scroll-target="#building-ml-df-using-vectorassembler">Building ML DF Using <code>VectorAssembler()</code></a></li>
  <li><a href="#building-lin-reg-model-using-linearregression.fit" id="toc-building-lin-reg-model-using-linearregression.fit" class="nav-link" data-scroll-target="#building-lin-reg-model-using-linearregression.fit">Building Lin Reg Model using <code>LinearRegression().fit()</code></a></li>
  <li><a href="#summary-of-regression-result" id="toc-summary-of-regression-result" class="nav-link" data-scroll-target="#summary-of-regression-result">Summary of Regression Result</a>
  <ul class="collapse">
  <li><a href="#making-summary-look-better" id="toc-making-summary-look-better" class="nav-link" data-scroll-target="#making-summary-look-better">Making Summary Look Better</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#multivariate-linear-regression-w-pyspark" id="toc-multivariate-linear-regression-w-pyspark" class="nav-link" data-scroll-target="#multivariate-linear-regression-w-pyspark">Multivariate Linear Regression w/ PySpark</a>
  <ul class="collapse">
  <li><a href="#adding-new-predictor-age-to-vectorassembler" id="toc-adding-new-predictor-age-to-vectorassembler" class="nav-link" data-scroll-target="#adding-new-predictor-age-to-vectorassembler">Adding new predictor <code>age</code> to VectorAssembler()</a></li>
  </ul></li>
  <li><a href="#residuals" id="toc-residuals" class="nav-link" data-scroll-target="#residuals">Residuals</a>
  <ul class="collapse">
  <li><a href="#residual-plots" id="toc-residual-plots" class="nav-link" data-scroll-target="#residual-plots">Residual Plots</a></li>
  <li><a href="#unbiasedness-and-homoskedasticity" id="toc-unbiasedness-and-homoskedasticity" class="nav-link" data-scroll-target="#unbiasedness-and-homoskedasticity">Unbiasedness and Homoskedasticity</a></li>
  <li><a href="#residual-plots-in-python" id="toc-residual-plots-in-python" class="nav-link" data-scroll-target="#residual-plots-in-python">Residual Plots in Python</a></li>
  </ul></li>
  <li><a href="#hypothesis-testing-on-beta-coefficients" id="toc-hypothesis-testing-on-beta-coefficients" class="nav-link" data-scroll-target="#hypothesis-testing-on-beta-coefficients">Hypothesis Testing on Beta Coefficient(s)</a></li>
  <li><a href="#coefficient-plots-in-python" id="toc-coefficient-plots-in-python" class="nav-link" data-scroll-target="#coefficient-plots-in-python">Coefficient Plots in Python</a></li>
  <li><a href="#lin-reg-w-log-transformation" id="toc-lin-reg-w-log-transformation" class="nav-link" data-scroll-target="#lin-reg-w-log-transformation">Lin Reg w/ Log Transformation</a>
  <ul class="collapse">
  <li><a href="#log-transformed-vars-in-pyspark" id="toc-log-transformed-vars-in-pyspark" class="nav-link" data-scroll-target="#log-transformed-vars-in-pyspark">Log-transformed Vars in PySpark</a></li>
  </ul></li>
  <li><a href="#lin-reg-w-interaction-terms" id="toc-lin-reg-w-interaction-terms" class="nav-link" data-scroll-target="#lin-reg-w-interaction-terms">Lin Reg w/ Interaction Terms</a></li>
  <li><a href="#classwork-8" id="toc-classwork-8" class="nav-link" data-scroll-target="#classwork-8">Classwork 8</a>
  <ul class="collapse">
  <li><a href="#q1" id="toc-q1" class="nav-link" data-scroll-target="#q1">Q1</a></li>
  <li><a href="#q2---splitting-into-test-and-train-sets" id="toc-q2---splitting-into-test-and-train-sets" class="nav-link" data-scroll-target="#q2---splitting-into-test-and-train-sets">Q2 - Splitting into test and train sets</a></li>
  <li><a href="#q3---training-model-and-splitting-cat-dummy" id="toc-q3---training-model-and-splitting-cat-dummy" class="nav-link" data-scroll-target="#q3---training-model-and-splitting-cat-dummy">Q3 - Training model and splitting cat –&gt; dummy</a></li>
  <li><a href="#q7" id="toc-q7" class="nav-link" data-scroll-target="#q7">Q7</a></li>
  <li><a href="#q8" id="toc-q8" class="nav-link" data-scroll-target="#q8">Q8</a></li>
  <li><a href="#q9" id="toc-q9" class="nav-link" data-scroll-target="#q9">Q9</a></li>
  <li><a href="#q10" id="toc-q10" class="nav-link" data-scroll-target="#q10">Q10</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">DANL 320 | Linear Regression w/ PySpark</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="importing-modules-reading" class="level1">
<h1>Importing Modules &amp; Reading</h1>
<hr>
<div id="cell-2" class="cell" data-outputid="b2b66db0-f314-47a2-c4be-974021fa27be" data-execution_count="3">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql <span class="im">import</span> SparkSession</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> rand, col, <span class="bu">pow</span>, mean, when</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.feature <span class="im">import</span> VectorAssembler</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.ml.regression <span class="im">import</span> LinearRegression</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>spark <span class="op">=</span> SparkSession.builder.master(<span class="st">"local[*]"</span>).getOrCreate()</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Read CSV data from URL</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df_pd <span class="op">=</span> pd.read_csv(<span class="st">'https://bcdanl.github.io/data/home_sales_nyc.csv'</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>sale_df <span class="op">=</span> spark.createDataFrame(df_pd)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>sale_df.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+-------+------------+--------------------+-----------------------+--------+----------+-----------------+----------------+-----------+----------------+-----------------+----------+---------+---+
|sale.date|borough|borough_name|        neighborhood|building_class_category|zip_code|sale_price|residential_units|commercial_units|total_units|land_square_feet|gross_square_feet|year_built|sale_year|age|
+---------+-------+------------+--------------------+-----------------------+--------+----------+-----------------+----------------+-----------+----------------+-----------------+----------+---------+---+
|  8/31/18|      2|       Bronx|CASTLE HILL/UNION...|   01 ONE FAMILY DWE...|   10473|    492525|                1|               0|          1|            2250|             1540|      1960|     2018| 58|
|  8/31/18|      2|       Bronx|           SOUNDVIEW|   01 ONE FAMILY DWE...|   10473|    105000|                1|               0|          1|            3980|             1025|      1910|     2018|108|
|  8/31/18|      3|    Brooklyn|        BOROUGH PARK|   01 ONE FAMILY DWE...|   11204|   1765000|                1|               0|          1|            2805|             1864|      1930|     2018| 88|
|  8/31/18|      3|    Brooklyn|          MILL BASIN|   01 ONE FAMILY DWE...|   11234|    950000|                1|               0|          1|            5200|             1852|      1960|     2018| 58|
|  8/31/18|      4|      Queens|         FLORAL PARK|   01 ONE FAMILY DWE...|   11004|    566000|                1|               0|          1|            4000|              832|      1950|     2018| 68|
|  8/31/18|      4|      Queens|      FLUSHING-NORTH|   01 ONE FAMILY DWE...|   11365|    839000|                1|               0|          1|            2600|             1438|      1950|     2018| 68|
|  8/31/18|      4|      Queens|       FRESH MEADOWS|   01 ONE FAMILY DWE...|   11365|    985000|                1|               0|          1|            5900|             1668|      1945|     2018| 73|
|  8/31/18|      4|      Queens|              HOLLIS|   01 ONE FAMILY DWE...|   11428|    499500|                1|               0|          1|            2400|             1152|      1925|     2018| 93|
|  8/31/18|      4|      Queens|     JACKSON HEIGHTS|   01 ONE FAMILY DWE...|   11372|   1425000|                1|               0|          1|            3400|             2050|      1925|     2018| 93|
|  8/31/18|      4|      Queens|           LAURELTON|   01 ONE FAMILY DWE...|   11413|    560000|                1|               0|          1|            3217|             1232|      1930|     2018| 88|
|  8/31/18|      4|      Queens|      MIDDLE VILLAGE|   01 ONE FAMILY DWE...|   11378|    755000|                1|               0|          1|            1800|             1192|      1945|     2018| 73|
|  8/31/18|      4|      Queens|          OZONE PARK|   01 ONE FAMILY DWE...|   11416|    499900|                1|               0|          1|            2500|             1224|      1915|     2018|103|
|  8/31/18|      4|      Queens|          OZONE PARK|   01 ONE FAMILY DWE...|   11417|    560000|                1|               0|          1|            2800|             1272|      1925|     2018| 93|
|  8/31/18|      4|      Queens| SPRINGFIELD GARDENS|   01 ONE FAMILY DWE...|   11434|    475000|                1|               0|          1|            3780|             1050|      1955|     2018| 63|
|  8/31/18|      4|      Queens|          ST. ALBANS|   01 ONE FAMILY DWE...|   11412|    526875|                1|               0|          1|            5940|             1426|      1945|     2018| 73|
|  8/31/18|      4|      Queens|          WHITESTONE|   01 ONE FAMILY DWE...|   11357|    773000|                1|               0|          1|            3770|             1056|      1950|     2018| 68|
|  8/31/18|      4|      Queens|           WOODHAVEN|   01 ONE FAMILY DWE...|   11421|    665000|                1|               0|          1|            1710|             1364|      1920|     2018| 98|
|  8/30/18|      2|       Bronx|           BRONXDALE|   01 ONE FAMILY DWE...|   10467|   1450000|                1|               1|          2|            6675|             2996|      1955|     2018| 63|
|  8/30/18|      2|       Bronx|           RIVERDALE|   01 ONE FAMILY DWE...|   10463|    885000|                1|               0|          1|            5000|             2350|      1925|     2018| 93|
|  8/30/18|      2|       Bronx|         THROGS NECK|   01 ONE FAMILY DWE...|   10465|    420000|                1|               0|          1|            3125|             2062|      1950|     2018| 68|
+---------+-------+------------+--------------------+-----------------------+--------+----------+-----------------+----------------+-----------+----------------+-----------------+----------+---------+---+
only showing top 20 rows
</code></pre>
</div>
</div>
</section>
<section id="univariate-linear-regression-w-pyspark" class="level1">
<h1>Univariate Linear Regression w/ PySpark</h1>
<hr>
<section id="splitting-data-into-train-and-test-sets" class="level2">
<h2 class="anchored" data-anchor-id="splitting-data-into-train-and-test-sets">Splitting Data into Train and Test Sets</h2>
<div id="cell-5" class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Split data into training and testing sets by creating a random column "gp"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sale_df <span class="op">=</span> sale_df.withColumn(<span class="st">"gp"</span>, rand(seed<span class="op">=</span><span class="dv">123</span>)) <span class="co"># seed is set for replication</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Splits 60-40 into training and test sets</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>dtrain <span class="op">=</span> sale_df.<span class="bu">filter</span>(col(<span class="st">"gp"</span>) <span class="op">&gt;=</span> <span class="fl">0.4</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>dtest <span class="op">=</span> sale_df.<span class="bu">filter</span>(col(<span class="st">"gp"</span>) <span class="op">&lt;</span> <span class="fl">0.4</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Or simply,</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>dtrain, dtest <span class="op">=</span> sale_df.randomSplit([<span class="fl">0.6</span>, <span class="fl">0.4</span>], seed <span class="op">=</span> <span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="building-ml-df-using-vectorassembler" class="level2">
<h2 class="anchored" data-anchor-id="building-ml-df-using-vectorassembler">Building ML DF Using <code>VectorAssembler()</code></h2>
<ul>
<li>VectorAssembler
<ul>
<li>Transformer in Pyspark ML Library</li>
<li>Used to combine multiple cols into single vector col</li>
<li>Many ML Algs in spark req predictors to be represented as a single vector</li>
<li>VectorAssembler often one of 1st steps in SparkML Pipeline</li>
</ul></li>
<li><code>VectorAssembler.transform()</code> returns DF with new col, specified in <strong><em>outputCol</em></strong> arg in VectorAssembler</li>
</ul>
<div id="cell-8" class="cell" data-outputid="acc3fca7-64e1-40c7-997b-1f91674b9c4c">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now assemble predictors using the renamed column</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>assembler1 <span class="op">=</span> VectorAssembler(</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    inputCols<span class="op">=</span>[<span class="st">"gross_square_feet"</span>],</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    outputCol<span class="op">=</span><span class="st">"predictors"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>dtrain1 <span class="op">=</span> assembler1.transform(dtrain) <span class="co"># training data</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>dtest1  <span class="op">=</span> assembler1.transform(dtest)  <span class="co"># test data</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Training Set'</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>dtrain1.select(<span class="st">"predictors"</span>, <span class="st">"sale_price"</span>).show()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Test Set'</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>dtest1.select(<span class="st">"predictors"</span>, <span class="st">"sale_price"</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training Set
+----------+----------+
|predictors|sale_price|
+----------+----------+
|  [1742.0]|    349830|
|  [2165.0]|    570000|
|  [1116.0]|    410000|
|  [1120.0]|    260000|
|  [2304.0]|    543556|
|  [1830.0]|    610000|
|  [4200.0]|   1650000|
|  [1446.0]|    905000|
|  [1445.0]|   1150000|
|   [978.0]|    850000|
|  [1444.0]|    980000|
|  [1510.0]|   1130000|
|  [1428.0]|    425000|
|  [1712.0]|    860000|
|  [1200.0]|   1020000|
|  [2363.0]|   1200000|
|  [1197.0]|    427000|
|  [1080.0]|    423000|
|  [1392.0]|    325000|
|  [1400.0]|    597000|
+----------+----------+
only showing top 20 rows

Test Set
+----------+----------+
|predictors|sale_price|
+----------+----------+
|  [1080.0]|    495000|
|  [2320.0]|    575000|
|  [2844.0]|   1700000|
|  [1696.0]|    650000|
|  [2000.0]|   1350000|
|  [2300.0]|   1500000|
|  [1314.0]|    940000|
|  [2452.0]|    550000|
|  [1125.0]|    820000|
|  [1690.0]|    235000|
|  [2163.0]|    695000|
|  [1870.0]|    590000|
|  [2052.0]|    715000|
|  [1728.0]|    999000|
|  [1650.0]|    720000|
|  [1682.0]|   1150000|
|  [1140.0]|    770000|
|  [1782.0]|    795000|
|  [1292.0]|    836000|
|  [2487.0]|   1075000|
+----------+----------+
only showing top 20 rows
</code></pre>
</div>
</div>
</section>
<section id="building-lin-reg-model-using-linearregression.fit" class="level2">
<h2 class="anchored" data-anchor-id="building-lin-reg-model-using-linearregression.fit">Building Lin Reg Model using <code>LinearRegression().fit()</code></h2>
<ul>
<li>LinearRegression(featuresCol = ‘predictors’, labelCol = ‘sale_price’)
<ul>
<li>Creates instance of Linear Regression class</li>
<li>features are in a col named <code>predictors</code></li>
<li>label is in a column named <code>sale_price</code></li>
</ul></li>
<li>.fit() trains lin reg model using training DF <code>dtrain1</code>
<ul>
<li>this process est beta coef. that best predict label from features</li>
</ul></li>
</ul>
<div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear regression model using the new label column "sale_price"</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> (</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    LinearRegression(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        featuresCol <span class="op">=</span> <span class="st">"predictors"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>        labelCol <span class="op">=</span> <span class="st">"sale_price"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    .fit(dtrain1)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="summary-of-regression-result" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-regression-result">Summary of Regression Result</h2>
<div id="cell-13" class="cell" data-outputid="78002efd-ec7c-4fad-cf9c-9b9c74e4647c">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>items<span class="op">=</span> [model1.intercept,</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>model1.coefficients,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>model1.summary.coefficientStandardErrors,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>model1.summary.rootMeanSquaredError,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>model1.summary.r2]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> items:</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="bu">print</span>(i)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>-28248.33125480523
[456.5835962723607]
[9.1585344019424, 14842.026122561703]
459852.1900902878
0.24763531485957802</code></pre>
</div>
</div>
<section id="making-summary-look-better" class="level3">
<h3 class="anchored" data-anchor-id="making-summary-look-better">Making Summary Look Better</h3>
<div id="cell-15" class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_table(model, assembler):</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates a formatted regression table from a fitted LinearRegression model and its VectorAssembler,</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">    and inserts a dashed horizontal line after the Intercept row. The table includes separate columns</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">    for the 95% confidence interval lower and upper bounds for each coefficient (computed at the 5% significance level)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">    and an "Observations" row (using model.summary.numInstances) above the R² row.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">    The RMSE row is placed as the last row.</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">    The columns are ordered as:</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">        Metric | Value | Significance | Std. Error | p-value | 95% CI Lower | 95% CI Upper</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">    For the "Value", "Std. Error", "95% CI Lower", and "95% CI Upper" columns, commas are inserted every three digits,</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">    with 3 decimal places (except for Observations which is formatted as an integer with commas).</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">        model: A fitted LinearRegression model (with a .summary attribute).</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">        assembler: The VectorAssembler used to assemble the features for the model.</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">        A formatted string containing the regression table.</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients and standard errors as NumPy arrays</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    coeffs <span class="op">=</span> model.coefficients.toArray()</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    std_errors_all <span class="op">=</span> np.array(model.summary.coefficientStandardErrors)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the intercept's standard error is included (one extra element)</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(std_errors_all) <span class="op">==</span> <span class="bu">len</span>(coeffs) <span class="op">+</span> <span class="dv">1</span>:</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> std_errors_all[<span class="dv">0</span>]</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>        std_errors <span class="op">=</span> std_errors_all[<span class="dv">1</span>:]</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> <span class="va">None</span></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>        std_errors <span class="op">=</span> std_errors_all</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute t-statistics for feature coefficients (t = beta / SE(beta))</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># t_stats = coeffs / std_errors</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    t_stats <span class="op">=</span> model.summary.tValues</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Degrees of freedom: number of instances minus number of predictors minus 1 (for intercept)</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> model.summary.numInstances <span class="op">-</span> <span class="bu">len</span>(coeffs) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the t-critical value for a 95% confidence interval (two-tailed, 5% significance)</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>    t_critical <span class="op">=</span> stats.t.ppf(<span class="fl">0.975</span>, df)</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute two-tailed p-values for each feature coefficient</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># p_values = [2 * (1 - stats.t.cdf(np.abs(t), df)) for t in t_stats]</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>    p_values <span class="op">=</span> model.summary.pValues</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Function to assign significance stars based on p-value</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> significance_stars(p):</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"***"</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"**"</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.1</span>:</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"*"</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build the table rows.</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Order: Metric, Value, Significance, Std. Error, p-value, 95% CI Lower, 95% CI Upper.</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> []</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature, beta, se, p <span class="kw">in</span> <span class="bu">zip</span>(assembler.getInputCols(), coeffs, std_errors, p_values):</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>        ci_lower <span class="op">=</span> beta <span class="op">-</span> t_critical <span class="op">*</span> se</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>        ci_upper <span class="op">=</span> beta <span class="op">+</span> t_critical <span class="op">*</span> se</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>        table.append([</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Beta: "</span> <span class="op">+</span> feature,       <span class="co"># Metric name</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>            beta,                     <span class="co"># Beta estimate (Value)</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>            significance_stars(p),    <span class="co"># Significance stars</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>            se,                       <span class="co"># Standard error</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>            p,                        <span class="co"># p-value</span></span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>            ci_lower,                 <span class="co"># 95% CI lower bound</span></span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>            ci_upper                  <span class="co"># 95% CI upper bound</span></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute and add the intercept row with its SE, p-value, significance, and CI (if available)</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> intercept_se <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>        intercept_t <span class="op">=</span> model.intercept <span class="op">/</span> intercept_se</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>        intercept_p <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> stats.t.cdf(np.<span class="bu">abs</span>(intercept_t), df))</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>        intercept_sig <span class="op">=</span> significance_stars(intercept_p)</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>        ci_intercept_lower <span class="op">=</span> model.intercept <span class="op">-</span> t_critical <span class="op">*</span> intercept_se</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        ci_intercept_upper <span class="op">=</span> model.intercept <span class="op">+</span> t_critical <span class="op">*</span> intercept_se</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> <span class="st">""</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>        intercept_p <span class="op">=</span> <span class="st">""</span></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>        intercept_sig <span class="op">=</span> <span class="st">""</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>        ci_intercept_lower <span class="op">=</span> <span class="st">""</span></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>        ci_intercept_upper <span class="op">=</span> <span class="st">""</span></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>    table.append([</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Intercept"</span>,</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>        model.intercept,</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>        intercept_sig,</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>        intercept_se,</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>        intercept_p,</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>        ci_intercept_lower,</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>        ci_intercept_upper</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append overall model metrics:</span></span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert an Observations row using model.summary.numInstances,</span></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># then an R² row, and finally the RMSE row as the last row.</span></span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>    table.append([<span class="st">"Observations"</span>, model.summary.numInstances, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>    table.append([<span class="st">"R²"</span>, model.summary.r2, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>    table.append([<span class="st">"RMSE"</span>, model.summary.rootMeanSquaredError, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format the table.</span></span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For the "Value" (index 1), "Std. Error" (index 3), "95% CI Lower" (index 5), and "95% CI Upper" (index 6) columns,</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># format with commas and 3 decimal places, except for Observations which should be an integer with commas.</span></span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For the p-value (index 4), format to 3 decimal places.</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>    formatted_table <span class="op">=</span> []</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>        formatted_row <span class="op">=</span> []</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(row):</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"Observations"</span> <span class="kw">and</span> i <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> <span class="bu">isinstance</span>(item, (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)) <span class="kw">and</span> item <span class="op">!=</span> <span class="st">""</span>:</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Format Observations as integer with commas, no decimals.</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>                formatted_row.append(<span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(item)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(item, (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)) <span class="kw">and</span> item <span class="op">!=</span> <span class="st">""</span>:</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>]:</span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>                    formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:,.3f}</span><span class="ss">"</span>)</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>                    formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>                    formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>                formatted_row.append(item)</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>        formatted_table.append(formatted_row)</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate the table string using tabulate.</span></span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>    table_str <span class="op">=</span> tabulate(</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>        formatted_table,</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">=</span>[<span class="st">"Metric"</span>, <span class="st">"Value"</span>, <span class="st">"Sig."</span>, <span class="st">"Std. Error"</span>, <span class="st">"p-value"</span>, <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span>],</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>        tablefmt<span class="op">=</span><span class="st">"pretty"</span>,</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>        colalign<span class="op">=</span>(<span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"center"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>)</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert a dashed line after the Intercept row for clarity.</span></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> table_str.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>    dash_line <span class="op">=</span> <span class="st">'-'</span> <span class="op">*</span> <span class="bu">len</span>(lines[<span class="dv">0</span>])</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, line <span class="kw">in</span> <span class="bu">enumerate</span>(lines):</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"Intercept"</span> <span class="kw">in</span> line <span class="kw">and</span> <span class="kw">not</span> line.strip().startswith(<span class="st">'+'</span>):</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>            lines.insert(i<span class="op">+</span><span class="dv">1</span>, dash_line)</span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(lines)</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a><span class="co"># print(regression_table(lr_model, assembler))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-16" class="cell" data-outputid="a4f42e04-3442-4c8f-bce5-8610b668751f">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regression_table(model1, assembler1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------------+-------------+------+------------+---------+--------------+--------------+
| Metric                  |       Value | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper |
+-------------------------+-------------+------+------------+---------+--------------+--------------+
| Beta: gross_square_feet |     456.584 | ***  | 14,842.026 |   0.000 |  -28,637.917 |   29,551.084 |
| Intercept               | -28,248.331 | ***  |      9.159 |   0.000 |  -28,266.285 |  -28,230.378 |
-----------------------------------------------------------------------------------------------------
| Observations            |       7,553 |      |            |         |              |              |
| R²                      |       0.248 |      |            |         |              |              |
| RMSE                    | 459,852.190 |      |            |         |              |              |
+-------------------------+-------------+------+------------+---------+--------------+--------------+</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="multivariate-linear-regression-w-pyspark" class="level1">
<h1>Multivariate Linear Regression w/ PySpark</h1>
<hr>
<section id="adding-new-predictor-age-to-vectorassembler" class="level2">
<h2 class="anchored" data-anchor-id="adding-new-predictor-age-to-vectorassembler">Adding new predictor <code>age</code> to VectorAssembler()</h2>
<div id="cell-20" class="cell" data-outputid="fcefeef6-5313-4e19-d38f-12e3be63fd53">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>assembler2 <span class="op">=</span> VectorAssembler(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                    inputCols<span class="op">=</span>[<span class="st">"gross_square_feet"</span>, <span class="st">"age"</span>],</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                    outputCol<span class="op">=</span><span class="st">"predictors"</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>dtrain2 <span class="op">=</span> assembler2.transform(dtrain)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>dtest2  <span class="op">=</span> assembler2.transform(dtest)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>model2 <span class="op">=</span> LinearRegression(</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                labelCol<span class="op">=</span><span class="st">"sale_price"</span>).fit(dtrain2)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>dtest2 <span class="op">=</span> model2.transform(dtest2)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regression_table(model2, assembler2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------------+--------------+------+------------+---------+--------------+--------------+
| Metric                  |        Value | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper |
+-------------------------+--------------+------+------------+---------+--------------+--------------+
| Beta: gross_square_feet |      463.107 | ***  |    192.136 |   0.000 |       86.467 |      839.748 |
| Beta: age               |    2,429.358 | ***  | 20,938.514 |   0.000 |  -38,615.955 |   43,474.670 |
| Intercept               | -216,925.023 | ***  |      9.078 |   0.000 | -216,942.819 | -216,907.227 |
------------------------------------------------------------------------------------------------------
| Observations            |        7,553 |      |            |         |              |              |
| R²                      |        0.263 |      |            |         |              |              |
| RMSE                    |  455,059.540 |      |            |         |              |              |
+-------------------------+--------------+------+------------+---------+--------------+--------------+</code></pre>
</div>
</div>
</section>
</section>
<section id="residuals" class="level1">
<h1>Residuals</h1>
<hr>
<ul>
<li><p>Residual Error is essentially the estimate of the error term (random noise) in lin reg expression.</p></li>
<li><p>residual error is found by Yi - Y_hati</p></li>
<li><p>or actual - predicted</p></li>
</ul>
<section id="residual-plots" class="level2">
<h2 class="anchored" data-anchor-id="residual-plots">Residual Plots</h2>
<ul>
<li>Scatterplot of fitted values and residuals
<ul>
<li>fitted values on x-axis and residuals on y-axis</li>
</ul></li>
<li>Can be used to diagnose quality of model results</li>
<li>Assumed that epsilon i (random noise, residual error estimates it), has mean of 0 with constant variance
<ul>
<li>well-behaved residual plot should bounce <strong>randomly</strong> and form a cloud roughly at zero residual level (around the x-axis, where x = 0 represents perfect prediction)</li>
</ul></li>
<li>esentially asking two questions… <br></li>
</ul>
<ol type="1">
<li>On average are predictions correct (is there a cloud around 0-residual line?)</li>
<li>Are there systematic errors (is there seeming to be a constant variance?, does it fan out? Stay close along 0-residual line?)</li>
</ol>
<p><img src="residual_plot_ex.png" class="img-fluid"></p>
</section>
<section id="unbiasedness-and-homoskedasticity" class="level2">
<h2 class="anchored" data-anchor-id="unbiasedness-and-homoskedasticity">Unbiasedness and Homoskedasticity</h2>
<ul>
<li>Would like residual plot to be:<br></li>
<li><strong>Unbiased</strong>:<br>
<ul>
<li>Have an average value of 0 in any thin vertical stretch</li>
</ul></li>
<li><strong>Homoskedastic</strong>:<br>
<ul>
<li>Have same spread of residuals in any thin vertical strip (ie; not fanning out, so to say)</li>
</ul></li>
<li>When the variance of residuals changes (not remaining constant) across predicted values, model suffers from <strong><em>heteroskedasticity</em></strong></li>
</ul>
<p><img src="uh_ex.png" class="img-fluid"></p>
<ul>
<li>If model is <strong>biased</strong>:</li>
<li>Consistently overpredicts or underpredicts for certain values
<ul>
<li>Indicates model may be misspecified (missing importants vars or using incorrect functional form)</li>
<li>Leads to biased param estimates, meaning coef are off, reducing validity of predictions and inferences</li>
</ul></li>
<li>If model is <strong>heteroscedastic</strong>:
<ul>
<li>Inefficient coef estimates
<ul>
<li>estimates remain unbiased but are no longer efficient (e.g.&nbsp;don’t have smallest variance)</li>
</ul></li>
<li>Biased standard errors
<ul>
<li>leads to unreliable p-vals and CIs, maybe resulting in invaling hyp-tests</li>
</ul></li>
<li>Misleading inferences
<ul>
<li>Predictors maybe misrepresented as statistically significant or insignificant</li>
</ul></li>
<li>Poor predictive performance
<ul>
<li>model might perform poorly on future data (poor generalization), especially if residual variance grows with higher predicted values</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="residual-plots-in-python" class="level2">
<h2 class="anchored" data-anchor-id="residual-plots-in-python">Residual Plots in Python</h2>
<p>PySpark does NOT have built-in viz capabilities - Have to convert PySpark DF to Pandas DF by using <code>.toPandas()</code></p>
<div id="cell-32" class="cell" data-outputid="c07fb226-027d-475c-869c-7f896fd5b4f7">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual plot for Model 2:</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert test predictions to Pandas</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rdf <span class="op">=</span> dtest2.select([<span class="st">"prediction"</span>, <span class="st">"sale_price"</span>]).toPandas()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Pred and actual following fitting data to model, on test set specifically</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>rdf[<span class="st">"residual"</span>] <span class="op">=</span> rdf[<span class="st">"sale_price"</span>] <span class="op">-</span> rdf[<span class="st">"prediction"</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>rdf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">

  <div id="df-07444ca6-a6dc-4b60-b67b-ea4a90e389d8" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">prediction</th>
<th data-quarto-table-cell-role="th">sale_price</th>
<th data-quarto-table-cell-role="th">residual</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5.577485e+05</td>
<td>495000</td>
<td>-62748.475868</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1.095561e+06</td>
<td>575000</td>
<td>-520561.348096</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1.384387e+06</td>
<td>1700000</td>
<td>315612.545346</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>7.822887e+05</td>
<td>650000</td>
<td>-132288.717881</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>9.473670e+05</td>
<td>1350000</td>
<td>402633.036838</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5110</td>
<td>5.196712e+05</td>
<td>467375</td>
<td>-52296.218118</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5111</td>
<td>1.519552e+06</td>
<td>1610000</td>
<td>90448.492334</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5112</td>
<td>6.282781e+05</td>
<td>365000</td>
<td>-263278.103427</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5113</td>
<td>3.512530e+05</td>
<td>235000</td>
<td>-116253.049319</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5114</td>
<td>3.713118e+05</td>
<td>480000</td>
<td>108688.210815</td>
</tr>
</tbody>
</table>

<p>5115 rows × 3 columns</p>
</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-07444ca6-a6dc-4b60-b67b-ea4a90e389d8')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-07444ca6-a6dc-4b60-b67b-ea4a90e389d8 button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-07444ca6-a6dc-4b60-b67b-ea4a90e389d8');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-4fc65b87-52ce-4ac5-b218-4f64c0a2f87c">
  <button class="colab-df-quickchart" onclick="quickchart('df-4fc65b87-52ce-4ac5-b218-4f64c0a2f87c')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-4fc65b87-52ce-4ac5-b218-4f64c0a2f87c button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_5edd615e-9516-456e-87a0-f6efb7314853">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('rdf')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_5edd615e-9516-456e-87a0-f6efb7314853 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('rdf');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div>
<p><strong>Then use matplotlib.pyplot to do a residual plot</strong></p>
<div id="cell-34" class="cell" data-outputid="28079e9a-161a-40b3-b224-5f7d5304d615">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm  <span class="co"># for lowess smoothing</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(rdf[<span class="st">"prediction"</span>], rdf[<span class="st">"residual"</span>], alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">"darkgray"</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Use lowess smoothing for the trend line</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>smoothed <span class="op">=</span> sm.nonparametric.lowess(rdf[<span class="st">"residual"</span>], rdf[<span class="st">"prediction"</span>])</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>plt.plot(smoothed[:, <span class="dv">0</span>], smoothed[:, <span class="dv">1</span>], color<span class="op">=</span><span class="st">"darkblue"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Perfect prediction line</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   A horizontal line at residual = 0</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Labeling</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted sale.price (Model 2)"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residual Plot for Model 2"</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regression_table(model2, assembler2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------------------------+--------------+------+------------+---------+--------------+--------------+
| Metric                  |        Value | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper |
+-------------------------+--------------+------+------------+---------+--------------+--------------+
| Beta: gross_square_feet |      463.107 | ***  |    192.136 |   0.000 |       86.467 |      839.748 |
| Beta: age               |    2,429.358 | ***  | 20,938.514 |   0.000 |  -38,615.955 |   43,474.670 |
| Intercept               | -216,925.023 | ***  |      9.078 |   0.000 | -216,942.819 | -216,907.227 |
------------------------------------------------------------------------------------------------------
| Observations            |        7,553 |      |            |         |              |              |
| R²                      |        0.263 |      |            |         |              |              |
| RMSE                    |  455,059.540 |      |            |         |              |              |
+-------------------------+--------------+------+------------+---------+--------------+--------------+</code></pre>
</div>
</div>
</section>
</section>
<section id="hypothesis-testing-on-beta-coefficients" class="level1">
<h1>Hypothesis Testing on Beta Coefficient(s)</h1>
<hr>
<ul>
<li><p>Goal is to determine whether an IV has a statistically effect on the DV in a lin reg model</p></li>
<li><p>We test whether a specific coefficient βj significantly differs from zero:</p>
<ul>
<li>Null Hypothesis (H0): βj=0 (No relationship)</li>
<li>Alternative Hypothesis (HA): βj≠0 (Significant relationship)</li>
</ul></li>
<li><p>The t-statistic is used to test each coefficient:</p>
<pre><code>- t=βj^−0SE(βj^)</code></pre></li>
</ul>
<p>βj^: Estimated coefficient <br> SE(βj^): Standard error of the estimate</p>
<ul>
<li>Will calc p-val based on t-dist with n-k-1 degrees of freedom</li>
<li>Compare p-value with chosen sig level (α)
<ul>
<li>If p-val &lt;= α: Reject H0 (Significant)</li>
<li>If p-val &gt; α: Fail to reject H0 (Not Sig)</li>
</ul></li>
<li>Rejecting H0 means there is sufficient evidence to suggest statistically sig relationsip between IV and DV</li>
</ul>
</section>
<section id="coefficient-plots-in-python" class="level1">
<h1>Coefficient Plots in Python</h1>
<div id="cell-40" class="cell" data-outputid="ef6d6082-a0b3-466d-bb50-e9f074e1bcab">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df_pd <span class="op">=</span> pd.read_csv(<span class="st">'https://bcdanl.github.io/data/home_sales_nyc.csv'</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>sale_df <span class="op">=</span> spark.createDataFrame(df_pd)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>sale_df.show()</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Split data into training and testing sets by creating a random column "gp"</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>sale_df <span class="op">=</span> sale_df.withColumn(<span class="st">"gp"</span>, rand(seed<span class="op">=</span><span class="dv">123</span>)) <span class="co"># seed is set for replication</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Splits 60-40 into training and test sets</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>dtrain <span class="op">=</span> sale_df.<span class="bu">filter</span>(col(<span class="st">"gp"</span>) <span class="op">&gt;=</span> <span class="fl">0.4</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>dtest <span class="op">=</span> sale_df.<span class="bu">filter</span>(col(<span class="st">"gp"</span>) <span class="op">&lt;</span> <span class="fl">0.4</span>)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Or simply,</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>dtrain, dtest <span class="op">=</span> sale_df.randomSplit([<span class="fl">0.6</span>, <span class="fl">0.4</span>], seed <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+-------+------------+--------------------+-----------------------+--------+----------+-----------------+----------------+-----------+----------------+-----------------+----------+---------+---+
|sale.date|borough|borough_name|        neighborhood|building_class_category|zip_code|sale_price|residential_units|commercial_units|total_units|land_square_feet|gross_square_feet|year_built|sale_year|age|
+---------+-------+------------+--------------------+-----------------------+--------+----------+-----------------+----------------+-----------+----------------+-----------------+----------+---------+---+
|  8/31/18|      2|       Bronx|CASTLE HILL/UNION...|   01 ONE FAMILY DWE...|   10473|    492525|                1|               0|          1|            2250|             1540|      1960|     2018| 58|
|  8/31/18|      2|       Bronx|           SOUNDVIEW|   01 ONE FAMILY DWE...|   10473|    105000|                1|               0|          1|            3980|             1025|      1910|     2018|108|
|  8/31/18|      3|    Brooklyn|        BOROUGH PARK|   01 ONE FAMILY DWE...|   11204|   1765000|                1|               0|          1|            2805|             1864|      1930|     2018| 88|
|  8/31/18|      3|    Brooklyn|          MILL BASIN|   01 ONE FAMILY DWE...|   11234|    950000|                1|               0|          1|            5200|             1852|      1960|     2018| 58|
|  8/31/18|      4|      Queens|         FLORAL PARK|   01 ONE FAMILY DWE...|   11004|    566000|                1|               0|          1|            4000|              832|      1950|     2018| 68|
|  8/31/18|      4|      Queens|      FLUSHING-NORTH|   01 ONE FAMILY DWE...|   11365|    839000|                1|               0|          1|            2600|             1438|      1950|     2018| 68|
|  8/31/18|      4|      Queens|       FRESH MEADOWS|   01 ONE FAMILY DWE...|   11365|    985000|                1|               0|          1|            5900|             1668|      1945|     2018| 73|
|  8/31/18|      4|      Queens|              HOLLIS|   01 ONE FAMILY DWE...|   11428|    499500|                1|               0|          1|            2400|             1152|      1925|     2018| 93|
|  8/31/18|      4|      Queens|     JACKSON HEIGHTS|   01 ONE FAMILY DWE...|   11372|   1425000|                1|               0|          1|            3400|             2050|      1925|     2018| 93|
|  8/31/18|      4|      Queens|           LAURELTON|   01 ONE FAMILY DWE...|   11413|    560000|                1|               0|          1|            3217|             1232|      1930|     2018| 88|
|  8/31/18|      4|      Queens|      MIDDLE VILLAGE|   01 ONE FAMILY DWE...|   11378|    755000|                1|               0|          1|            1800|             1192|      1945|     2018| 73|
|  8/31/18|      4|      Queens|          OZONE PARK|   01 ONE FAMILY DWE...|   11416|    499900|                1|               0|          1|            2500|             1224|      1915|     2018|103|
|  8/31/18|      4|      Queens|          OZONE PARK|   01 ONE FAMILY DWE...|   11417|    560000|                1|               0|          1|            2800|             1272|      1925|     2018| 93|
|  8/31/18|      4|      Queens| SPRINGFIELD GARDENS|   01 ONE FAMILY DWE...|   11434|    475000|                1|               0|          1|            3780|             1050|      1955|     2018| 63|
|  8/31/18|      4|      Queens|          ST. ALBANS|   01 ONE FAMILY DWE...|   11412|    526875|                1|               0|          1|            5940|             1426|      1945|     2018| 73|
|  8/31/18|      4|      Queens|          WHITESTONE|   01 ONE FAMILY DWE...|   11357|    773000|                1|               0|          1|            3770|             1056|      1950|     2018| 68|
|  8/31/18|      4|      Queens|           WOODHAVEN|   01 ONE FAMILY DWE...|   11421|    665000|                1|               0|          1|            1710|             1364|      1920|     2018| 98|
|  8/30/18|      2|       Bronx|           BRONXDALE|   01 ONE FAMILY DWE...|   10467|   1450000|                1|               1|          2|            6675|             2996|      1955|     2018| 63|
|  8/30/18|      2|       Bronx|           RIVERDALE|   01 ONE FAMILY DWE...|   10463|    885000|                1|               0|          1|            5000|             2350|      1925|     2018| 93|
|  8/30/18|      2|       Bronx|         THROGS NECK|   01 ONE FAMILY DWE...|   10465|    420000|                1|               0|          1|            3125|             2062|      1950|     2018| 68|
+---------+-------+------------+--------------------+-----------------------+--------+----------+-----------------+----------------+-----------+----------------+-----------------+----------+---------+---+
only showing top 20 rows
</code></pre>
</div>
</div>
<div id="cell-41" class="cell" data-outputid="0295d041-815e-46a6-8667-90fb0bc0605e">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0: Bronx, 1: Brooklyn, 2: Manhattan, 3: Queens, 4: Staten Island</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>dummy_cols, ref_category <span class="op">=</span> add_dummy_variables(<span class="st">"borough_name"</span>, <span class="dv">2</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># To see dummy variables</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>dtrain.select([<span class="st">'borough_name'</span>] <span class="op">+</span> dummy_cols).show()</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>dtrain.select([<span class="st">'borough_name'</span>] <span class="op">+</span> dummy_cols).<span class="bu">filter</span>(col(<span class="st">'borough_name'</span>) <span class="op">==</span> <span class="st">"Manhattan"</span>).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reference category (dummy omitted): Manhattan
+------------+------------------+---------------------+-------------------+--------------------------+
|borough_name|borough_name_Bronx|borough_name_Brooklyn|borough_name_Queens|borough_name_Staten_Island|
+------------+------------------+---------------------+-------------------+--------------------------+
|       Bronx|                 1|                    0|                  0|                         0|
|       Bronx|                 1|                    0|                  0|                         0|
|    Brooklyn|                 0|                    1|                  0|                         0|
|    Brooklyn|                 0|                    1|                  0|                         0|
|    Brooklyn|                 0|                    1|                  0|                         0|
|    Brooklyn|                 0|                    1|                  0|                         0|
|    Brooklyn|                 0|                    1|                  0|                         0|
|    Brooklyn|                 0|                    1|                  0|                         0|
|    Brooklyn|                 0|                    1|                  0|                         0|
|    Brooklyn|                 0|                    1|                  0|                         0|
|      Queens|                 0|                    0|                  1|                         0|
|      Queens|                 0|                    0|                  1|                         0|
|      Queens|                 0|                    0|                  1|                         0|
|      Queens|                 0|                    0|                  1|                         0|
|      Queens|                 0|                    0|                  1|                         0|
|       Bronx|                 1|                    0|                  0|                         0|
|       Bronx|                 1|                    0|                  0|                         0|
|       Bronx|                 1|                    0|                  0|                         0|
|       Bronx|                 1|                    0|                  0|                         0|
|    Brooklyn|                 0|                    1|                  0|                         0|
+------------+------------------+---------------------+-------------------+--------------------------+
only showing top 20 rows

+------------+------------------+---------------------+-------------------+--------------------------+
|borough_name|borough_name_Bronx|borough_name_Brooklyn|borough_name_Queens|borough_name_Staten_Island|
+------------+------------------+---------------------+-------------------+--------------------------+
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
|   Manhattan|                 0|                    0|                  0|                         0|
+------------+------------------+---------------------+-------------------+--------------------------+
only showing top 20 rows
</code></pre>
</div>
</div>
<div id="cell-42" class="cell" data-outputid="e561e45d-0b77-4a32-c76e-dcf7a52702d2">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the list of predictor columns:</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Two numeric predictors plus the dummy variables (excluding the reference dummy)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>conti_cols <span class="op">=</span> [<span class="st">"gross_square_feet"</span>, <span class="st">"age"</span>]</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>assembler_predictors <span class="op">=</span> conti_cols <span class="op">+</span> dummy_cols</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>assembler3 <span class="op">=</span> VectorAssembler(</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    inputCols <span class="op">=</span> assembler_predictors,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    outputCol <span class="op">=</span> <span class="st">"predictors"</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>dtrain3 <span class="op">=</span> assembler3.transform(dtrain)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>dtest3  <span class="op">=</span> assembler3.transform(dtest)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>model3 <span class="op">=</span> LinearRegression(featuresCol<span class="op">=</span><span class="st">"predictors"</span>, labelCol<span class="op">=</span><span class="st">"sale_price"</span>).fit(dtrain3)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>dtest3 <span class="op">=</span> model3.transform(dtest3)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># For model3 and assembler3:</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regression_table(model3, assembler3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----------------------------------+----------------+------+------------+---------+----------------+----------------+
| Metric                           |          Value | Sig. | Std. Error | p-value |   95% CI Lower |   95% CI Upper |
+----------------------------------+----------------+------+------------+---------+----------------+----------------+
| Beta: gross_square_feet          |        391.989 | ***  |    204.243 |   0.000 |         -8.384 |        792.362 |
| Beta: age                        |         -7.449 |      | 75,441.043 |   0.971 |   -147,892.897 |    147,877.998 |
| Beta: borough_name_Bronx         | -3,107,734.887 | ***  | 74,462.161 |   0.000 | -3,253,701.453 | -2,961,768.320 |
| Beta: borough_name_Brooklyn      | -2,659,313.821 | ***  | 74,276.127 |   0.000 | -2,804,915.709 | -2,513,711.933 |
| Beta: borough_name_Queens        | -2,870,994.746 | ***  | 75,420.358 |   0.000 | -3,018,839.645 | -2,723,149.847 |
| Beta: borough_name_Staten_Island | -3,023,379.363 | ***  | 80,985.266 |   0.000 | -3,182,133.032 | -2,864,625.694 |
| Intercept                        |  2,953,483.693 | ***  |      8.252 |   0.000 |  2,953,467.518 |  2,953,499.869 |
---------------------------------------------------------------------------------------------------------------------
| Observations                     |          7,553 |      |            |         |                |                |
| R²                               |          0.427 |      |            |         |                |                |
| RMSE                             |    401,379.450 |      |            |         |                |                |
+----------------------------------+----------------+------+------------+---------+----------------+----------------+</code></pre>
</div>
</div>
<div id="cell-43" class="cell" data-outputid="107d56c1-47e6-4ec0-c187-fed1fd54b7df">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a Pandas DataFrame from model3's summary information</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>terms <span class="op">=</span> assembler3.getInputCols()</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>coefs <span class="op">=</span> model3.coefficients.toArray()[:<span class="bu">len</span>(terms)]</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>stdErrs <span class="op">=</span> model3.summary.coefficientStandardErrors[:<span class="bu">len</span>(terms)]</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>df_summary <span class="op">=</span> pd.DataFrame({</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"term"</span>: terms,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"estimate"</span>: coefs,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"std_error"</span>: stdErrs</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot using the DataFrame columns</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>plt.errorbar(df_summary[<span class="st">"term"</span>], df_summary[<span class="st">"estimate"</span>],</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>             yerr <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> df_summary[<span class="st">"std_error"</span>], fmt<span class="op">=</span><span class="st">'o'</span>, capsize<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Terms"</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Coefficient Estimate"</span>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Coefficient Estimates (Model 2)"</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)  <span class="co"># Add horizontal line at 0</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lin-reg-w-log-transformation" class="level1">
<h1>Lin Reg w/ Log Transformation</h1>
<section id="log-transformed-vars-in-pyspark" class="level2">
<h2 class="anchored" data-anchor-id="log-transformed-vars-in-pyspark">Log-transformed Vars in PySpark</h2>
<div id="cell-46" class="cell" data-outputid="45d8f5a4-467e-42aa-f5af-9ec22483267f" data-execution_count="4">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pyspark.sql.functions <span class="im">import</span> log</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>sale_df <span class="op">=</span> sale_df.withColumn(<span class="st">"log_sale_price"</span>,</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>                              log( sale_df[<span class="st">'sale_price'</span>] ) )</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>sale_df.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------+-------+------------+--------------------+-----------------------+--------+----------+-----------------+----------------+-----------+----------------+-----------------+----------+---------+---+------------------+
|sale.date|borough|borough_name|        neighborhood|building_class_category|zip_code|sale_price|residential_units|commercial_units|total_units|land_square_feet|gross_square_feet|year_built|sale_year|age|    log_sale_price|
+---------+-------+------------+--------------------+-----------------------+--------+----------+-----------------+----------------+-----------+----------------+-----------------+----------+---------+---+------------------+
|  8/31/18|      2|       Bronx|CASTLE HILL/UNION...|   01 ONE FAMILY DWE...|   10473|    492525|                1|               0|          1|            2250|             1540|      1960|     2018| 58|13.107300499727284|
|  8/31/18|      2|       Bronx|           SOUNDVIEW|   01 ONE FAMILY DWE...|   10473|    105000|                1|               0|          1|            3980|             1025|      1910|     2018|108| 11.56171562913966|
|  8/31/18|      3|    Brooklyn|        BOROUGH PARK|   01 ONE FAMILY DWE...|   11204|   1765000|                1|               0|          1|            2805|             1864|      1930|     2018| 88|14.383661248349535|
|  8/31/18|      3|    Brooklyn|          MILL BASIN|   01 ONE FAMILY DWE...|   11234|    950000|                1|               0|          1|            5200|             1852|      1960|     2018| 58|13.764217263576723|
|  8/31/18|      4|      Queens|         FLORAL PARK|   01 ONE FAMILY DWE...|   11004|    566000|                1|               0|          1|            4000|              832|      1950|     2018| 68| 13.24634935718532|
|  8/31/18|      4|      Queens|      FLUSHING-NORTH|   01 ONE FAMILY DWE...|   11365|    839000|                1|               0|          1|            2600|             1438|      1950|     2018| 68|13.639965985449344|
|  8/31/18|      4|      Queens|       FRESH MEADOWS|   01 ONE FAMILY DWE...|   11365|    985000|                1|               0|          1|            5900|             1668|      1945|     2018| 73|13.800396920154226|
|  8/31/18|      4|      Queens|              HOLLIS|   01 ONE FAMILY DWE...|   11428|    499500|                1|               0|          1|            2400|             1152|      1925|     2018| 93|13.121362877070744|
|  8/31/18|      4|      Queens|     JACKSON HEIGHTS|   01 ONE FAMILY DWE...|   11372|   1425000|                1|               0|          1|            3400|             2050|      1925|     2018| 93|14.169682371684887|
|  8/31/18|      4|      Queens|           LAURELTON|   01 ONE FAMILY DWE...|   11413|    560000|                1|               0|          1|            3217|             1232|      1930|     2018| 88|13.235692062711331|
|  8/31/18|      4|      Queens|      MIDDLE VILLAGE|   01 ONE FAMILY DWE...|   11378|    755000|                1|               0|          1|            1800|             1192|      1945|     2018| 73|13.534473028231162|
|  8/31/18|      4|      Queens|          OZONE PARK|   01 ONE FAMILY DWE...|   11416|    499900|                1|               0|          1|            2500|             1224|      1915|     2018|103|13.122163357401663|
|  8/31/18|      4|      Queens|          OZONE PARK|   01 ONE FAMILY DWE...|   11417|    560000|                1|               0|          1|            2800|             1272|      1925|     2018| 93|13.235692062711331|
|  8/31/18|      4|      Queens| SPRINGFIELD GARDENS|   01 ONE FAMILY DWE...|   11434|    475000|                1|               0|          1|            3780|             1050|      1955|     2018| 63|13.071070083016778|
|  8/31/18|      4|      Queens|          ST. ALBANS|   01 ONE FAMILY DWE...|   11412|    526875|                1|               0|          1|            5940|             1426|      1945|     2018| 73|13.174718607738257|
|  8/31/18|      4|      Queens|          WHITESTONE|   01 ONE FAMILY DWE...|   11357|    773000|                1|               0|          1|            3770|             1056|      1950|     2018| 68|13.558034327569558|
|  8/31/18|      4|      Queens|           WOODHAVEN|   01 ONE FAMILY DWE...|   11421|    665000|                1|               0|          1|            1710|             1364|      1920|     2018| 98|13.407542319637992|
|  8/30/18|      2|       Bronx|           BRONXDALE|   01 ONE FAMILY DWE...|   10467|   1450000|                1|               1|          2|            6675|             2996|      1955|     2018| 63|14.187074114396758|
|  8/30/18|      2|       Bronx|           RIVERDALE|   01 ONE FAMILY DWE...|   10463|    885000|                1|               0|          1|            5000|             2350|      1925|     2018| 93|13.693342923990066|
|  8/30/18|      2|       Bronx|         THROGS NECK|   01 ONE FAMILY DWE...|   10465|    420000|                1|               0|          1|            3125|             2062|      1950|     2018| 68|12.948009990259552|
+---------+-------+------------+--------------------+-----------------------+--------+----------+-----------------+----------------+-----------+----------------+-----------------+----------+---------+---+------------------+
only showing top 20 rows
</code></pre>
</div>
</div>
</section>
</section>
<section id="lin-reg-w-interaction-terms" class="level1">
<h1>Lin Reg w/ Interaction Terms</h1>
<ul>
<li><p>Used to address situations where X1 may vary by X2, where X2 is often a dummy var</p></li>
<li><p>In terms of the nyc df, sale.price may vary by borough name</p></li>
<li><p>Will initialize a new param (for the general example above): &gt; w1X1 + w2X2 + w3(X1*X2) + b</p></li>
</ul>
<p>Example in terms of nyc df: <img src="linreg_int.png" class="img-fluid"></p>
</section>
<section id="classwork-8" class="level1">
<h1>Classwork 8</h1>
<hr>
<hr>
<section id="q1" class="level2">
<h2 class="anchored" data-anchor-id="q1">Q1</h2>
<div id="cell-52" class="cell" data-outputid="66ad32ab-a77d-4433-94ca-0c7ab386678f" data-execution_count="7">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>bikeshare <span class="op">=</span> pd.read_csv(<span class="st">'https://bcdanl.github.io/data/bikeshare_cleaned.csv'</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>bikeshare <span class="op">=</span> spark.createDataFrame(bikeshare)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>bikeshare.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---+----+-----+----+---+--------+-------+-------+--------------------+------------------+-----------------+------------------+
|cnt|year|month|date| hr|   wkday|holiday|seasons|        weather_cond|              temp|              hum|         windspeed|
+---+----+-----+----+---+--------+-------+-------+--------------------+------------------+-----------------+------------------+
| 16|2011|    1|   1|  0|saturday|      0| spring| Clear or Few Cloudy| -1.33460918694128|0.947345243330896|  -1.5538438052971|
| 40|2011|    1|   1|  1|saturday|      0| spring| Clear or Few Cloudy| -1.43847500990342|0.895512927978679|  -1.5538438052971|
| 32|2011|    1|   1|  2|saturday|      0| spring| Clear or Few Cloudy| -1.43847500990342|0.895512927978679|  -1.5538438052971|
| 13|2011|    1|   1|  3|saturday|      0| spring| Clear or Few Cloudy| -1.33460918694128|0.636351351217591|  -1.5538438052971|
|  1|2011|    1|   1|  4|saturday|      0| spring| Clear or Few Cloudy| -1.33460918694128|0.636351351217591|  -1.5538438052971|
|  1|2011|    1|   1|  5|saturday|      0| spring|      Mist or Cloudy| -1.33460918694128|0.636351351217591|-0.821460017517193|
|  2|2011|    1|   1|  6|saturday|      0| spring| Clear or Few Cloudy| -1.43847500990342|0.895512927978679|  -1.5538438052971|
|  3|2011|    1|   1|  7|saturday|      0| spring| Clear or Few Cloudy| -1.54234083286556| 1.20650682009198|  -1.5538438052971|
|  8|2011|    1|   1|  8|saturday|      0| spring| Clear or Few Cloudy| -1.33460918694128|0.636351351217591|  -1.5538438052971|
| 14|2011|    1|   1|  9|saturday|      0| spring| Clear or Few Cloudy|-0.919145895092722|0.688183666569809|  -1.5538438052971|
| 36|2011|    1|   1| 10|saturday|      0| spring| Clear or Few Cloudy|-0.607548426206302|0.688183666569809| 0.519881272378821|
| 56|2011|    1|   1| 11|saturday|      0| spring| Clear or Few Cloudy|-0.711414249168442|0.947345243330896| 0.764281665845554|
| 84|2011|    1|   1| 12|saturday|      0| spring| Clear or Few Cloudy|-0.399816780282022|0.740015981922026| 0.764281665845554|
| 94|2011|    1|   1| 13|saturday|      0| spring|      Mist or Cloudy|-0.192085134357741|0.480854405160939| 0.886073166268775|
|106|2011|    1|   1| 14|saturday|      0| spring|      Mist or Cloudy|-0.192085134357741|0.480854405160939| 0.764281665845554|
|110|2011|    1|   1| 15|saturday|      0| spring|      Mist or Cloudy|-0.295950957319881|0.740015981922026| 0.886073166268775|
| 93|2011|    1|   1| 16|saturday|      0| spring|      Mist or Cloudy|-0.399816780282022|0.999177558683113| 0.886073166268775|
| 67|2011|    1|   1| 17|saturday|      0| spring|      Mist or Cloudy|-0.295950957319881|0.999177558683113| 0.764281665845554|
| 35|2011|    1|   1| 18|saturday|      0| spring|Light Snow or Lig...|-0.399816780282022| 1.31017145079642| 0.519881272378821|
| 37|2011|    1|   1| 19|saturday|      0| spring|Light Snow or Lig...|-0.399816780282022| 1.31017145079642| 0.519881272378821|
+---+----+-----+----+---+--------+-------+-------+--------------------+------------------+-----------------+------------------+
only showing top 20 rows
</code></pre>
</div>
</div>
<div id="cell-53" class="cell" data-outputid="e14b29c4-6e0f-4912-c9e8-a66e8b507bf5" data-execution_count="8">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>bikeshare.describe().show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------+-----------------+------------------+------------------+------------------+------------------+---------+--------------------+-------+-------------------+--------------------+--------------------+--------------------+
|summary|              cnt|              year|             month|              date|                hr|    wkday|             holiday|seasons|       weather_cond|                temp|                 hum|           windspeed|
+-------+-----------------+------------------+------------------+------------------+------------------+---------+--------------------+-------+-------------------+--------------------+--------------------+--------------------+
|  count|            17376|             17376|             17376|             17376|             17376|    17376|               17376|  17376|              17376|               17376|               17376|               17376|
|   mean|189.4829650092081| 2011.502532228361| 6.538731583793738|15.682895948434622|11.546731123388582|     NULL|0.028775322283609576|   NULL|               NULL|2.782432173414443E-4|-2.29186617616944...|-1.96196719787483...|
| stddev|181.3950218567111|0.5000079758750275|3.4383025228315445| 8.789544988430704| 6.914283222380914|     NULL|  0.1671792797835931|   NULL|               NULL|  0.9998593726137501|  0.9999316512968688|  1.0000301062750698|
|    min|                1|              2011|                 1|                 1|                 0|   friday|                   0|   fall|Clear or Few Cloudy|   -2.47713323952482|   -3.25107230019872|    -1.5538438052971|
|    max|              977|              2012|                12|                31|                23|wednesday|                   1| winter|     Mist or Cloudy|    2.61229208562004|    1.93215923502303|    5.39971521551057|
+-------+-----------------+------------------+------------------+------------------+------------------+---------+--------------------+-------+-------------------+--------------------+--------------------+--------------------+
</code></pre>
</div>
</div>
<div id="cell-54" class="cell" data-outputid="9e24716c-00a6-4743-974b-05728afed9e7" data-execution_count="9">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    bikeshare</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'holiday'</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    .count()</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    .show() <span class="co"># Can be done for each var</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-------+-----+
|holiday|count|
+-------+-----+
|      0|16876|
|      1|  500|
+-------+-----+
</code></pre>
</div>
</div>
</section>
<section id="q2---splitting-into-test-and-train-sets" class="level2">
<h2 class="anchored" data-anchor-id="q2---splitting-into-test-and-train-sets">Q2 - Splitting into test and train sets</h2>
<div id="cell-56" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>bikeshare <span class="op">=</span> bikeshare.withColumn(<span class="st">"gp"</span>, rand(seed<span class="op">=</span><span class="dv">123</span>)) <span class="co"># seed is set for replication</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Splits 60-40 into training and test sets</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>dtrain <span class="op">=</span> bikeshare.<span class="bu">filter</span>(col(<span class="st">"gp"</span>) <span class="op">&gt;=</span> <span class="fl">0.4</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>dtest <span class="op">=</span> bikeshare.<span class="bu">filter</span>(col(<span class="st">"gp"</span>) <span class="op">&lt;</span> <span class="fl">0.4</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Or simply,</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>dtrain, dtest <span class="op">=</span> bikeshare.randomSplit([<span class="fl">0.6</span>, <span class="fl">0.4</span>], seed <span class="op">=</span> <span class="dv">123</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="q3---training-model-and-splitting-cat-dummy" class="level2">
<h2 class="anchored" data-anchor-id="q3---training-model-and-splitting-cat-dummy">Q3 - Training model and splitting cat –&gt; dummy</h2>
<div id="cell-58" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_dummy_variables(var_name, reference_level, category_order<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates dummy variables for the specified column in the global DataFrames dtrain and dtest.</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">    Allows manual setting of category order.</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">        var_name (str): The name of the categorical column (e.g., "borough_name").</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">        reference_level (int): Index of the category to be used as the reference (dummy omitted).</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">        category_order (list, optional): List of categories in the desired order. If None, categories are sorted.</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="co">        dummy_cols (list): List of dummy column names excluding the reference category.</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co">        ref_category (str): The category chosen as the reference.</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> dtrain, dtest</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get distinct categories from the training set.</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> dtrain.select(var_name).distinct().rdd.flatMap(<span class="kw">lambda</span> x: x).collect()</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert booleans to strings if present.</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    categories <span class="op">=</span> [<span class="bu">str</span>(c) <span class="cf">if</span> <span class="bu">isinstance</span>(c, <span class="bu">bool</span>) <span class="cf">else</span> c <span class="cf">for</span> c <span class="kw">in</span> categories]</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use manual category order if provided; otherwise, sort categories.</span></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> category_order:</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Ensure all categories are present in the user-defined order</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>        missing <span class="op">=</span> <span class="bu">set</span>(categories) <span class="op">-</span> <span class="bu">set</span>(category_order)</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> missing:</span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"These categories are missing from your custom order: </span><span class="sc">{</span>missing<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a>        categories <span class="op">=</span> category_order</span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>        categories <span class="op">=</span> <span class="bu">sorted</span>(categories)</span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate reference_level</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> reference_level <span class="op">&lt;</span> <span class="dv">0</span> <span class="kw">or</span> reference_level <span class="op">&gt;=</span> <span class="bu">len</span>(categories):</span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f"reference_level must be between 0 and </span><span class="sc">{</span><span class="bu">len</span>(categories) <span class="op">-</span> <span class="dv">1</span><span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the reference category</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a>    ref_category <span class="op">=</span> categories[reference_level]</span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Reference category (dummy omitted):"</span>, ref_category)</span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create dummy variables for all categories</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> cat <span class="kw">in</span> categories:</span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a>        dummy_col_name <span class="op">=</span> var_name <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> <span class="bu">str</span>(cat).replace(<span class="st">" "</span>, <span class="st">"_"</span>)</span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a>        dtrain <span class="op">=</span> dtrain.withColumn(dummy_col_name, when(col(var_name) <span class="op">==</span> cat, <span class="dv">1</span>).otherwise(<span class="dv">0</span>))</span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a>        dtest <span class="op">=</span> dtest.withColumn(dummy_col_name, when(col(var_name) <span class="op">==</span> cat, <span class="dv">1</span>).otherwise(<span class="dv">0</span>))</span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># List of dummy columns, excluding the reference category</span></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a>    dummy_cols <span class="op">=</span> [var_name <span class="op">+</span> <span class="st">"_"</span> <span class="op">+</span> <span class="bu">str</span>(cat).replace(<span class="st">" "</span>, <span class="st">"_"</span>) <span class="cf">for</span> cat <span class="kw">in</span> categories <span class="cf">if</span> cat <span class="op">!=</span> ref_category]</span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dummy_cols, ref_category</span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage without category_order:</span></span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy_cols_year, ref_category_year = add_dummy_variables('year', 0)</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage with category_order:</span></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a><span class="co"># custom_order_wkday = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday']</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a><span class="co"># dummy_cols_wkday, ref_category_wkday = add_dummy_variables('wkday', reference_level=0, category_order = custom_order_wkday)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-59" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy.stats <span class="im">as</span> stats</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> regression_table(model, assembler):</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Creates a formatted regression table from a fitted LinearRegression model and its VectorAssembler,</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co">    and inserts a dashed horizontal line after the Intercept row. The table includes separate columns</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">    for the 95% confidence interval lower and upper bounds for each coefficient (computed at the 5% significance level)</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">    and an "Observations" row (using model.summary.numInstances) above the R² row.</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co">    The RMSE row is placed as the last row.</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co">    The columns are ordered as:</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="co">        Metric | Value | Significance | Std. Error | p-value | 95% CI Lower | 95% CI Upper</span></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="co">    For the "Value", "Std. Error", "95% CI Lower", and "95% CI Upper" columns, commas are inserted every three digits,</span></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="co">    with 3 decimal places (except for Observations which is formatted as an integer with commas).</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co">        model: A fitted LinearRegression model (with a .summary attribute).</span></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="co">        assembler: The VectorAssembler used to assemble the features for the model.</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a><span class="co">        A formatted string containing the regression table.</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients and standard errors as NumPy arrays</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    coeffs <span class="op">=</span> model.coefficients.toArray()</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>    std_errors_all <span class="op">=</span> np.array(model.summary.coefficientStandardErrors)</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check if the intercept's standard error is included (one extra element)</span></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(std_errors_all) <span class="op">==</span> <span class="bu">len</span>(coeffs) <span class="op">+</span> <span class="dv">1</span>:</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> std_errors_all[<span class="dv">0</span>]</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>        std_errors <span class="op">=</span> std_errors_all[<span class="dv">1</span>:]</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> <span class="va">None</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>        std_errors <span class="op">=</span> std_errors_all</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute t-statistics for feature coefficients (t = beta / SE(beta))</span></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># t_stats = coeffs / std_errors</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>    t_stats <span class="op">=</span> model.summary.tValues</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Degrees of freedom: number of instances minus number of predictors minus 1 (for intercept)</span></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> model.summary.numInstances <span class="op">-</span> <span class="bu">len</span>(coeffs) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute the t-critical value for a 95% confidence interval (two-tailed, 5% significance)</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>    t_critical <span class="op">=</span> stats.t.ppf(<span class="fl">0.975</span>, df)</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute two-tailed p-values for each feature coefficient</span></span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># p_values = [2 * (1 - stats.t.cdf(np.abs(t), df)) for t in t_stats]</span></span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a>    p_values <span class="op">=</span> model.summary.pValues</span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Function to assign significance stars based on p-value</span></span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> significance_stars(p):</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p <span class="op">&lt;</span> <span class="fl">0.01</span>:</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"***"</span></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.05</span>:</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"**"</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p <span class="op">&lt;</span> <span class="fl">0.1</span>:</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">"*"</span></span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="st">""</span></span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Build the table rows.</span></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Order: Metric, Value, Significance, Std. Error, p-value, 95% CI Lower, 95% CI Upper.</span></span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> []</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> feature, beta, se, p <span class="kw">in</span> <span class="bu">zip</span>(assembler.getInputCols(), coeffs, std_errors, p_values):</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>        ci_lower <span class="op">=</span> beta <span class="op">-</span> t_critical <span class="op">*</span> se</span>
<span id="cb35-68"><a href="#cb35-68" aria-hidden="true" tabindex="-1"></a>        ci_upper <span class="op">=</span> beta <span class="op">+</span> t_critical <span class="op">*</span> se</span>
<span id="cb35-69"><a href="#cb35-69" aria-hidden="true" tabindex="-1"></a>        table.append([</span>
<span id="cb35-70"><a href="#cb35-70" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Beta: "</span> <span class="op">+</span> feature,       <span class="co"># Metric name</span></span>
<span id="cb35-71"><a href="#cb35-71" aria-hidden="true" tabindex="-1"></a>            beta,                     <span class="co"># Beta estimate (Value)</span></span>
<span id="cb35-72"><a href="#cb35-72" aria-hidden="true" tabindex="-1"></a>            significance_stars(p),    <span class="co"># Significance stars</span></span>
<span id="cb35-73"><a href="#cb35-73" aria-hidden="true" tabindex="-1"></a>            se,                       <span class="co"># Standard error</span></span>
<span id="cb35-74"><a href="#cb35-74" aria-hidden="true" tabindex="-1"></a>            p,                        <span class="co"># p-value</span></span>
<span id="cb35-75"><a href="#cb35-75" aria-hidden="true" tabindex="-1"></a>            ci_lower,                 <span class="co"># 95% CI lower bound</span></span>
<span id="cb35-76"><a href="#cb35-76" aria-hidden="true" tabindex="-1"></a>            ci_upper                  <span class="co"># 95% CI upper bound</span></span>
<span id="cb35-77"><a href="#cb35-77" aria-hidden="true" tabindex="-1"></a>        ])</span>
<span id="cb35-78"><a href="#cb35-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-79"><a href="#cb35-79" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Compute and add the intercept row with its SE, p-value, significance, and CI (if available)</span></span>
<span id="cb35-80"><a href="#cb35-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> intercept_se <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb35-81"><a href="#cb35-81" aria-hidden="true" tabindex="-1"></a>        intercept_t <span class="op">=</span> model.intercept <span class="op">/</span> intercept_se</span>
<span id="cb35-82"><a href="#cb35-82" aria-hidden="true" tabindex="-1"></a>        intercept_p <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">-</span> stats.t.cdf(np.<span class="bu">abs</span>(intercept_t), df))</span>
<span id="cb35-83"><a href="#cb35-83" aria-hidden="true" tabindex="-1"></a>        intercept_sig <span class="op">=</span> significance_stars(intercept_p)</span>
<span id="cb35-84"><a href="#cb35-84" aria-hidden="true" tabindex="-1"></a>        ci_intercept_lower <span class="op">=</span> model.intercept <span class="op">-</span> t_critical <span class="op">*</span> intercept_se</span>
<span id="cb35-85"><a href="#cb35-85" aria-hidden="true" tabindex="-1"></a>        ci_intercept_upper <span class="op">=</span> model.intercept <span class="op">+</span> t_critical <span class="op">*</span> intercept_se</span>
<span id="cb35-86"><a href="#cb35-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb35-87"><a href="#cb35-87" aria-hidden="true" tabindex="-1"></a>        intercept_se <span class="op">=</span> <span class="st">""</span></span>
<span id="cb35-88"><a href="#cb35-88" aria-hidden="true" tabindex="-1"></a>        intercept_p <span class="op">=</span> <span class="st">""</span></span>
<span id="cb35-89"><a href="#cb35-89" aria-hidden="true" tabindex="-1"></a>        intercept_sig <span class="op">=</span> <span class="st">""</span></span>
<span id="cb35-90"><a href="#cb35-90" aria-hidden="true" tabindex="-1"></a>        ci_intercept_lower <span class="op">=</span> <span class="st">""</span></span>
<span id="cb35-91"><a href="#cb35-91" aria-hidden="true" tabindex="-1"></a>        ci_intercept_upper <span class="op">=</span> <span class="st">""</span></span>
<span id="cb35-92"><a href="#cb35-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-93"><a href="#cb35-93" aria-hidden="true" tabindex="-1"></a>    table.append([</span>
<span id="cb35-94"><a href="#cb35-94" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Intercept"</span>,</span>
<span id="cb35-95"><a href="#cb35-95" aria-hidden="true" tabindex="-1"></a>        model.intercept,</span>
<span id="cb35-96"><a href="#cb35-96" aria-hidden="true" tabindex="-1"></a>        intercept_sig,</span>
<span id="cb35-97"><a href="#cb35-97" aria-hidden="true" tabindex="-1"></a>        intercept_se,</span>
<span id="cb35-98"><a href="#cb35-98" aria-hidden="true" tabindex="-1"></a>        intercept_p,</span>
<span id="cb35-99"><a href="#cb35-99" aria-hidden="true" tabindex="-1"></a>        ci_intercept_lower,</span>
<span id="cb35-100"><a href="#cb35-100" aria-hidden="true" tabindex="-1"></a>        ci_intercept_upper</span>
<span id="cb35-101"><a href="#cb35-101" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb35-102"><a href="#cb35-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-103"><a href="#cb35-103" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append overall model metrics:</span></span>
<span id="cb35-104"><a href="#cb35-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert an Observations row using model.summary.numInstances,</span></span>
<span id="cb35-105"><a href="#cb35-105" aria-hidden="true" tabindex="-1"></a>    <span class="co"># then an R² row, and finally the RMSE row as the last row.</span></span>
<span id="cb35-106"><a href="#cb35-106" aria-hidden="true" tabindex="-1"></a>    table.append([<span class="st">"Observations"</span>, model.summary.numInstances, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb35-107"><a href="#cb35-107" aria-hidden="true" tabindex="-1"></a>    table.append([<span class="st">"R²"</span>, model.summary.r2, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb35-108"><a href="#cb35-108" aria-hidden="true" tabindex="-1"></a>    table.append([<span class="st">"RMSE"</span>, model.summary.rootMeanSquaredError, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>, <span class="st">""</span>])</span>
<span id="cb35-109"><a href="#cb35-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-110"><a href="#cb35-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format the table.</span></span>
<span id="cb35-111"><a href="#cb35-111" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For the "Value" (index 1), "Std. Error" (index 3), "95% CI Lower" (index 5), and "95% CI Upper" (index 6) columns,</span></span>
<span id="cb35-112"><a href="#cb35-112" aria-hidden="true" tabindex="-1"></a>    <span class="co"># format with commas and 3 decimal places, except for Observations which should be an integer with commas.</span></span>
<span id="cb35-113"><a href="#cb35-113" aria-hidden="true" tabindex="-1"></a>    <span class="co"># For the p-value (index 4), format to 3 decimal places.</span></span>
<span id="cb35-114"><a href="#cb35-114" aria-hidden="true" tabindex="-1"></a>    formatted_table <span class="op">=</span> []</span>
<span id="cb35-115"><a href="#cb35-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> row <span class="kw">in</span> table:</span>
<span id="cb35-116"><a href="#cb35-116" aria-hidden="true" tabindex="-1"></a>        formatted_row <span class="op">=</span> []</span>
<span id="cb35-117"><a href="#cb35-117" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i, item <span class="kw">in</span> <span class="bu">enumerate</span>(row):</span>
<span id="cb35-118"><a href="#cb35-118" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> row[<span class="dv">0</span>] <span class="op">==</span> <span class="st">"Observations"</span> <span class="kw">and</span> i <span class="op">==</span> <span class="dv">1</span> <span class="kw">and</span> <span class="bu">isinstance</span>(item, (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)) <span class="kw">and</span> item <span class="op">!=</span> <span class="st">""</span>:</span>
<span id="cb35-119"><a href="#cb35-119" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Format Observations as integer with commas, no decimals.</span></span>
<span id="cb35-120"><a href="#cb35-120" aria-hidden="true" tabindex="-1"></a>                formatted_row.append(<span class="ss">f"</span><span class="sc">{</span><span class="bu">int</span>(item)<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb35-121"><a href="#cb35-121" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="bu">isinstance</span>(item, (<span class="bu">int</span>, <span class="bu">float</span>, np.floating)) <span class="kw">and</span> item <span class="op">!=</span> <span class="st">""</span>:</span>
<span id="cb35-122"><a href="#cb35-122" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> i <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>]:</span>
<span id="cb35-123"><a href="#cb35-123" aria-hidden="true" tabindex="-1"></a>                    formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:,.3f}</span><span class="ss">"</span>)</span>
<span id="cb35-124"><a href="#cb35-124" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> i <span class="op">==</span> <span class="dv">4</span>:</span>
<span id="cb35-125"><a href="#cb35-125" aria-hidden="true" tabindex="-1"></a>                    formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb35-126"><a href="#cb35-126" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb35-127"><a href="#cb35-127" aria-hidden="true" tabindex="-1"></a>                    formatted_row.append(<span class="ss">f"</span><span class="sc">{</span>item<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb35-128"><a href="#cb35-128" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb35-129"><a href="#cb35-129" aria-hidden="true" tabindex="-1"></a>                formatted_row.append(item)</span>
<span id="cb35-130"><a href="#cb35-130" aria-hidden="true" tabindex="-1"></a>        formatted_table.append(formatted_row)</span>
<span id="cb35-131"><a href="#cb35-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-132"><a href="#cb35-132" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Generate the table string using tabulate.</span></span>
<span id="cb35-133"><a href="#cb35-133" aria-hidden="true" tabindex="-1"></a>    table_str <span class="op">=</span> tabulate(</span>
<span id="cb35-134"><a href="#cb35-134" aria-hidden="true" tabindex="-1"></a>        formatted_table,</span>
<span id="cb35-135"><a href="#cb35-135" aria-hidden="true" tabindex="-1"></a>        headers<span class="op">=</span>[<span class="st">"Metric"</span>, <span class="st">"Value"</span>, <span class="st">"Sig."</span>, <span class="st">"Std. Error"</span>, <span class="st">"p-value"</span>, <span class="st">"95% CI Lower"</span>, <span class="st">"95% CI Upper"</span>],</span>
<span id="cb35-136"><a href="#cb35-136" aria-hidden="true" tabindex="-1"></a>        tablefmt<span class="op">=</span><span class="st">"pretty"</span>,</span>
<span id="cb35-137"><a href="#cb35-137" aria-hidden="true" tabindex="-1"></a>        colalign<span class="op">=</span>(<span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"center"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>, <span class="st">"right"</span>)</span>
<span id="cb35-138"><a href="#cb35-138" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb35-139"><a href="#cb35-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-140"><a href="#cb35-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Insert a dashed line after the Intercept row for clarity.</span></span>
<span id="cb35-141"><a href="#cb35-141" aria-hidden="true" tabindex="-1"></a>    lines <span class="op">=</span> table_str.split(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb35-142"><a href="#cb35-142" aria-hidden="true" tabindex="-1"></a>    dash_line <span class="op">=</span> <span class="st">'-'</span> <span class="op">*</span> <span class="bu">len</span>(lines[<span class="dv">0</span>])</span>
<span id="cb35-143"><a href="#cb35-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, line <span class="kw">in</span> <span class="bu">enumerate</span>(lines):</span>
<span id="cb35-144"><a href="#cb35-144" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">"Intercept"</span> <span class="kw">in</span> line <span class="kw">and</span> <span class="kw">not</span> line.strip().startswith(<span class="st">'+'</span>):</span>
<span id="cb35-145"><a href="#cb35-145" aria-hidden="true" tabindex="-1"></a>            lines.insert(i<span class="op">+</span><span class="dv">1</span>, dash_line)</span>
<span id="cb35-146"><a href="#cb35-146" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span></span>
<span id="cb35-147"><a href="#cb35-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-148"><a href="#cb35-148" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>.join(lines)</span>
<span id="cb35-149"><a href="#cb35-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-150"><a href="#cb35-150" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage:</span></span>
<span id="cb35-151"><a href="#cb35-151" aria-hidden="true" tabindex="-1"></a><span class="co"># print(regression_table(lr_model, assembler))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-60" class="cell" data-outputid="4c15e33f-cc8e-4108-d537-796f341edf03" data-execution_count="13">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dummy_cols_year, ref_cat_year <span class="op">=</span> add_dummy_variables(<span class="st">'year'</span>, <span class="dv">0</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>dummy_cols_month, ref_cat_month <span class="op">=</span> add_dummy_variables(<span class="st">'month'</span>, <span class="dv">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>dummy_cols_hr, ref_cat_hr <span class="op">=</span> add_dummy_variables(<span class="st">'hr'</span>, <span class="dv">0</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>dummy_cols_hol, ref_cat_hol <span class="op">=</span> add_dummy_variables(<span class="st">'holiday'</span>, <span class="dv">0</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>dummy_cols_wc, ref_cat_wc <span class="op">=</span> add_dummy_variables(<span class="st">'weather_cond'</span>, <span class="dv">0</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>custom_order_wkday <span class="op">=</span> [<span class="st">'sunday'</span>, <span class="st">'monday'</span>, <span class="st">'tuesday'</span>, <span class="st">'wednesday'</span>, <span class="st">'thursday'</span>, <span class="st">'friday'</span>, <span class="st">'saturday'</span>]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>dummy_cols_day, ref_cat_day <span class="op">=</span> add_dummy_variables(<span class="st">'wkday'</span>, reference_level<span class="op">=</span><span class="dv">0</span>, category_order <span class="op">=</span> custom_order_wkday)</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>custom_order_season <span class="op">=</span> [<span class="st">'spring'</span>, <span class="st">'summer'</span>, <span class="st">'fall'</span>, <span class="st">'winter'</span>]</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>dummy_cols_season, ref_cat_season <span class="op">=</span> add_dummy_variables(<span class="st">'seasons'</span>, reference_level<span class="op">=</span><span class="dv">0</span>, category_order <span class="op">=</span> custom_order_season)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>cont_cols <span class="op">=</span> [<span class="st">'temp'</span>, <span class="st">'hum'</span>, <span class="st">'windspeed'</span>]</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> cont_cols <span class="op">+</span> dummy_cols_year <span class="op">+</span> dummy_cols_month <span class="op">+</span> dummy_cols_hr <span class="op">+</span> dummy_cols_hol <span class="op">+</span> dummy_cols_wc <span class="op">+</span> dummy_cols_day <span class="op">+</span> dummy_cols_season</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reference category (dummy omitted): 2011
Reference category (dummy omitted): 1
Reference category (dummy omitted): 0
Reference category (dummy omitted): 0
Reference category (dummy omitted): Clear or Few Cloudy
Reference category (dummy omitted): sunday
Reference category (dummy omitted): spring</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>assembler_d <span class="op">=</span> VectorAssembler(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                    inputCols<span class="op">=</span> features,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                    outputCol<span class="op">=</span><span class="st">"predictors"</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>dtrain2 <span class="op">=</span> assembler_d.transform(dtrain)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>dtest2  <span class="op">=</span> assembler_d.transform(dtest)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>model_d <span class="op">=</span> LinearRegression(</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>                featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>                labelCol<span class="op">=</span><span class="st">"cnt"</span>).fit(dtrain2)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>dtest2 <span class="op">=</span> model_d.transform(dtest2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="cell-62" class="cell" data-outputid="ac38336c-0d3d-474d-9402-725bf1053dbe" data-execution_count="15">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regression_table(model_d, assembler_d))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------------------------------------------+---------+------+------------+---------+--------------+--------------+
| Metric                                      |   Value | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper |
+---------------------------------------------+---------+------+------------+---------+--------------+--------------+
| Beta: temp                                  |  42.329 | ***  |      1.396 |   0.000 |       39.592 |       45.066 |
| Beta: hum                                   | -15.818 | ***  |      1.095 |   0.000 |      -17.964 |      -13.673 |
| Beta: windspeed                             |  -4.592 | ***  |      2.033 |   0.000 |       -8.577 |       -0.607 |
| Beta: year_2012                             |  85.733 | ***  |      5.067 |   0.000 |       75.801 |       95.664 |
| Beta: month_2                               |   5.204 |      |      5.702 |   0.304 |       -5.973 |       16.380 |
| Beta: month_3                               |  13.331 |  **  |      8.473 |   0.019 |       -3.278 |       29.940 |
| Beta: month_4                               |   6.755 |      |      9.060 |   0.425 |      -11.004 |       24.515 |
| Beta: month_5                               |  17.228 |  *   |      9.321 |   0.057 |       -1.042 |       35.499 |
| Beta: month_6                               |   8.092 |      |     10.481 |   0.385 |      -12.453 |       28.638 |
| Beta: month_7                               |  -9.133 |      |     10.181 |   0.384 |      -29.090 |       10.825 |
| Beta: month_8                               |  15.455 |      |      9.060 |   0.129 |       -2.304 |       33.215 |
| Beta: month_9                               |  34.747 | ***  |      8.383 |   0.000 |       18.314 |       51.180 |
| Beta: month_10                              |  13.061 |      |      8.089 |   0.119 |       -2.795 |       28.918 |
| Beta: month_11                              | -10.117 |      |      6.398 |   0.211 |      -22.658 |        2.424 |
| Beta: month_12                              |  -6.010 |      |      6.856 |   0.348 |      -19.448 |        7.429 |
| Beta: hr_1                                  | -18.319 | ***  |      6.844 |   0.008 |      -31.735 |       -4.902 |
| Beta: hr_2                                  | -26.524 | ***  |      7.037 |   0.000 |      -40.319 |      -12.730 |
| Beta: hr_3                                  | -40.579 | ***  |      6.946 |   0.000 |      -54.195 |      -26.964 |
| Beta: hr_4                                  | -35.211 | ***  |      6.830 |   0.000 |      -48.600 |      -21.823 |
| Beta: hr_5                                  | -21.258 | ***  |      6.896 |   0.002 |      -34.775 |       -7.740 |
| Beta: hr_6                                  |  33.752 | ***  |      6.850 |   0.000 |       20.324 |       47.181 |
| Beta: hr_7                                  | 175.927 | ***  |      6.821 |   0.000 |      162.556 |      189.298 |
| Beta: hr_8                                  | 315.633 | ***  |      6.908 |   0.000 |      302.092 |      329.174 |
| Beta: hr_9                                  | 164.763 | ***  |      6.850 |   0.000 |      151.337 |      178.190 |
| Beta: hr_10                                 | 113.238 | ***  |      6.906 |   0.000 |       99.701 |      126.776 |
| Beta: hr_11                                 | 134.600 | ***  |      6.910 |   0.000 |      121.055 |      148.145 |
| Beta: hr_12                                 | 173.827 | ***  |      7.187 |   0.000 |      159.739 |      187.916 |
| Beta: hr_13                                 | 166.014 | ***  |      7.172 |   0.000 |      151.955 |      180.074 |
| Beta: hr_14                                 | 149.687 | ***  |      7.102 |   0.000 |      135.766 |      163.608 |
| Beta: hr_15                                 | 166.505 | ***  |      7.093 |   0.000 |      152.601 |      180.408 |
| Beta: hr_16                                 | 231.115 | ***  |      7.034 |   0.000 |      217.326 |      244.904 |
| Beta: hr_17                                 | 373.796 | ***  |      6.927 |   0.000 |      360.219 |      387.374 |
| Beta: hr_18                                 | 345.005 | ***  |      6.900 |   0.000 |      331.480 |      358.531 |
| Beta: hr_19                                 | 236.633 | ***  |      6.948 |   0.000 |      223.013 |      250.252 |
| Beta: hr_20                                 | 156.109 | ***  |      6.801 |   0.000 |      142.777 |      169.441 |
| Beta: hr_21                                 | 109.951 | ***  |      6.870 |   0.000 |       96.485 |      123.417 |
| Beta: hr_22                                 |  72.172 | ***  |      6.827 |   0.000 |       58.790 |       85.554 |
| Beta: hr_23                                 |  35.565 | ***  |      6.242 |   0.000 |       23.329 |       47.801 |
| Beta: holiday_1                             | -28.657 | ***  |      4.148 |   0.000 |      -36.787 |      -20.527 |
| Beta: weather_cond_Light_Snow_or_Light_Rain | -67.007 | ***  |      2.491 |   0.000 |      -71.889 |      -62.125 |
| Beta: weather_cond_Mist_or_Cloudy           |  -9.108 | ***  |      3.888 |   0.000 |      -16.729 |       -1.486 |
| Beta: wkday_monday                          |  12.929 | ***  |      3.787 |   0.001 |        5.506 |       20.352 |
| Beta: wkday_tuesday                         |  14.432 | ***  |      3.769 |   0.000 |        7.044 |       21.821 |
| Beta: wkday_wednesday                       |  16.434 | ***  |      3.788 |   0.000 |        9.010 |       23.859 |
| Beta: wkday_thursday                        |  16.409 | ***  |      3.751 |   0.000 |        9.056 |       23.762 |
| Beta: wkday_friday                          |  18.646 | ***  |      3.766 |   0.000 |       11.264 |       26.029 |
| Beta: wkday_saturday                        |  19.887 | ***  |      6.231 |   0.000 |        7.673 |       32.100 |
| Beta: seasons_summer                        |  42.796 | ***  |      7.429 |   0.000 |       28.233 |       57.358 |
| Beta: seasons_fall                          |  29.693 | ***  |      6.289 |   0.000 |       17.366 |       42.021 |
| Beta: seasons_winter                        |  68.686 | ***  |      7.452 |   0.000 |       54.078 |       83.294 |
| Intercept                                   | -27.648 | ***  |      2.362 |   0.000 |      -32.278 |      -23.017 |
---------------------------------------------------------------------------------------------------------------------
| Observations                                |  10,375 |      |            |         |              |              |
| R²                                          |   0.686 |      |            |         |              |              |
| RMSE                                        | 101.792 |      |            |         |              |              |
+---------------------------------------------+---------+------+------------+---------+--------------+--------------+</code></pre>
</div>
</div>
</section>
<section id="q7" class="level2">
<h2 class="anchored" data-anchor-id="q7">Q7</h2>
<div id="cell-64" class="cell" data-outputid="a4d2fb7b-a06f-4f33-d7f2-941a35a60e2e" data-execution_count="16">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>feat <span class="op">=</span> assembler_d.getInputCols()</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>cf <span class="op">=</span> model_d.coefficients.toArray()[:<span class="bu">len</span>(feat)]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>err <span class="op">=</span> model_d.summary.coefficientStandardErrors[:<span class="bu">len</span>(feat)]</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>df_cw8 <span class="op">=</span> pd.DataFrame({</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'features'</span>: feat,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'est'</span>: cf,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'std_error'</span>: err</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>df_cw8</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

  <div id="df-da58c459-3d1c-47a8-b49a-966ca2306f2c" class="colab-df-container">
    <div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">features</th>
<th data-quarto-table-cell-role="th">est</th>
<th data-quarto-table-cell-role="th">std_error</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>temp</td>
<td>42.328840</td>
<td>2.362286</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>hum</td>
<td>-15.818284</td>
<td>1.396342</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>windspeed</td>
<td>-4.591617</td>
<td>1.094665</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>year_2012</td>
<td>85.732784</td>
<td>2.032948</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>month_2</td>
<td>5.203765</td>
<td>5.066519</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>month_3</td>
<td>13.331414</td>
<td>5.701653</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>month_4</td>
<td>6.755455</td>
<td>8.473106</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>month_5</td>
<td>17.228385</td>
<td>9.059851</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>month_6</td>
<td>8.092298</td>
<td>9.320895</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9</td>
<td>month_7</td>
<td>-9.132514</td>
<td>10.481312</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">10</td>
<td>month_8</td>
<td>15.455288</td>
<td>10.181348</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>month_9</td>
<td>34.746980</td>
<td>9.060099</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">12</td>
<td>month_10</td>
<td>13.061047</td>
<td>8.383432</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">13</td>
<td>month_11</td>
<td>-10.116635</td>
<td>8.089260</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">14</td>
<td>month_12</td>
<td>-6.009642</td>
<td>6.397776</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>hr_1</td>
<td>-18.318628</td>
<td>6.855656</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">16</td>
<td>hr_2</td>
<td>-26.524415</td>
<td>6.844365</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">17</td>
<td>hr_3</td>
<td>-40.579348</td>
<td>7.037231</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">18</td>
<td>hr_4</td>
<td>-35.211397</td>
<td>6.946024</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">19</td>
<td>hr_5</td>
<td>-21.257603</td>
<td>6.830045</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>hr_6</td>
<td>33.752431</td>
<td>6.896172</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">21</td>
<td>hr_7</td>
<td>175.926741</td>
<td>6.850407</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>hr_8</td>
<td>315.633093</td>
<td>6.821242</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>hr_9</td>
<td>164.763257</td>
<td>6.907784</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">24</td>
<td>hr_10</td>
<td>113.238368</td>
<td>6.849508</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">25</td>
<td>hr_11</td>
<td>134.600307</td>
<td>6.906237</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">26</td>
<td>hr_12</td>
<td>173.827217</td>
<td>6.910010</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">27</td>
<td>hr_13</td>
<td>166.014368</td>
<td>7.187343</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">28</td>
<td>hr_14</td>
<td>149.687063</td>
<td>7.172399</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">29</td>
<td>hr_15</td>
<td>166.504572</td>
<td>7.102071</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">30</td>
<td>hr_16</td>
<td>231.114910</td>
<td>7.092921</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">31</td>
<td>hr_17</td>
<td>373.796154</td>
<td>7.034380</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">32</td>
<td>hr_18</td>
<td>345.005402</td>
<td>6.926682</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">33</td>
<td>hr_19</td>
<td>236.632654</td>
<td>6.900097</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">34</td>
<td>hr_20</td>
<td>156.109006</td>
<td>6.947926</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">35</td>
<td>hr_21</td>
<td>109.951052</td>
<td>6.801294</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">36</td>
<td>hr_22</td>
<td>72.171886</td>
<td>6.869633</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">37</td>
<td>hr_23</td>
<td>35.564908</td>
<td>6.826905</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">38</td>
<td>holiday_1</td>
<td>-28.657206</td>
<td>6.242407</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">39</td>
<td>weather_cond_Light_Snow_or_Light_Rain</td>
<td>-67.006931</td>
<td>4.147649</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">40</td>
<td>weather_cond_Mist_or_Cloudy</td>
<td>-9.107550</td>
<td>2.490628</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">41</td>
<td>wkday_monday</td>
<td>12.929103</td>
<td>3.888132</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">42</td>
<td>wkday_tuesday</td>
<td>14.432173</td>
<td>3.786723</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">43</td>
<td>wkday_wednesday</td>
<td>16.434304</td>
<td>3.769332</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>wkday_thursday</td>
<td>16.408760</td>
<td>3.787523</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">45</td>
<td>wkday_friday</td>
<td>18.646276</td>
<td>3.751100</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">46</td>
<td>wkday_saturday</td>
<td>19.886551</td>
<td>3.766310</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">47</td>
<td>seasons_summer</td>
<td>42.795819</td>
<td>6.230614</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">48</td>
<td>seasons_fall</td>
<td>29.693335</td>
<td>7.429177</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">49</td>
<td>seasons_winter</td>
<td>68.685740</td>
<td>6.289078</td>
</tr>
</tbody>
</table>

</div>
    <div class="colab-df-buttons">

  <div class="colab-df-container">
    <button class="colab-df-convert" onclick="convertToInteractive('df-da58c459-3d1c-47a8-b49a-966ca2306f2c')" title="Convert this dataframe to an interactive table." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 -960 960 960">
    <path d="M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z"></path>
  </svg>
    </button>

  <style>
    .colab-df-container {
      display:flex;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    .colab-df-buttons div {
      margin-bottom: 4px;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

    <script>
      const buttonEl =
        document.querySelector('#df-da58c459-3d1c-47a8-b49a-966ca2306f2c button.colab-df-convert');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      async function convertToInteractive(key) {
        const element = document.querySelector('#df-da58c459-3d1c-47a8-b49a-966ca2306f2c');
        const dataTable =
          await google.colab.kernel.invokeFunction('convertToInteractive',
                                                    [key], {});
        if (!dataTable) return;

        const docLinkHtml = 'Like what you see? Visit the ' +
          '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
          + ' to learn more about interactive tables.';
        element.innerHTML = '';
        dataTable['output_type'] = 'display_data';
        await google.colab.output.renderOutput(dataTable, element);
        const docLink = document.createElement('div');
        docLink.innerHTML = docLinkHtml;
        element.appendChild(docLink);
      }
    </script>
  </div>


<div id="df-4572a8c5-efb9-47e2-8603-adbe4bf7db87">
  <button class="colab-df-quickchart" onclick="quickchart('df-4572a8c5-efb9-47e2-8603-adbe4bf7db87')" title="Suggest charts" style="display:none;">

<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <g>
        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"></path>
    </g>
</svg>
  </button>

<style>
  .colab-df-quickchart {
      --bg-color: #E8F0FE;
      --fill-color: #1967D2;
      --hover-bg-color: #E2EBFA;
      --hover-fill-color: #174EA6;
      --disabled-fill-color: #AAA;
      --disabled-bg-color: #DDD;
  }

  [theme=dark] .colab-df-quickchart {
      --bg-color: #3B4455;
      --fill-color: #D2E3FC;
      --hover-bg-color: #434B5C;
      --hover-fill-color: #FFFFFF;
      --disabled-bg-color: #3B4455;
      --disabled-fill-color: #666;
  }

  .colab-df-quickchart {
    background-color: var(--bg-color);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: none;
    fill: var(--fill-color);
    height: 32px;
    padding: 0;
    width: 32px;
  }

  .colab-df-quickchart:hover {
    background-color: var(--hover-bg-color);
    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    fill: var(--button-hover-fill-color);
  }

  .colab-df-quickchart-complete:disabled,
  .colab-df-quickchart-complete:disabled:hover {
    background-color: var(--disabled-bg-color);
    fill: var(--disabled-fill-color);
    box-shadow: none;
  }

  .colab-df-spinner {
    border: 2px solid var(--fill-color);
    border-color: transparent;
    border-bottom-color: var(--fill-color);
    animation:
      spin 1s steps(1) infinite;
  }

  @keyframes spin {
    0% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
      border-left-color: var(--fill-color);
    }
    20% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    30% {
      border-color: transparent;
      border-left-color: var(--fill-color);
      border-top-color: var(--fill-color);
      border-right-color: var(--fill-color);
    }
    40% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-top-color: var(--fill-color);
    }
    60% {
      border-color: transparent;
      border-right-color: var(--fill-color);
    }
    80% {
      border-color: transparent;
      border-right-color: var(--fill-color);
      border-bottom-color: var(--fill-color);
    }
    90% {
      border-color: transparent;
      border-bottom-color: var(--fill-color);
    }
  }
</style>

  <script>
    async function quickchart(key) {
      const quickchartButtonEl =
        document.querySelector('#' + key + ' button');
      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.
      quickchartButtonEl.classList.add('colab-df-spinner');
      try {
        const charts = await google.colab.kernel.invokeFunction(
            'suggestCharts', [key], {});
      } catch (error) {
        console.error('Error during call to suggestCharts:', error);
      }
      quickchartButtonEl.classList.remove('colab-df-spinner');
      quickchartButtonEl.classList.add('colab-df-quickchart-complete');
    }
    (() => {
      let quickchartButtonEl =
        document.querySelector('#df-4572a8c5-efb9-47e2-8603-adbe4bf7db87 button');
      quickchartButtonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';
    })();
  </script>
</div>

  <div id="id_60b2f760-2744-4752-a5c4-10a766ed89f2">
    <style>
      .colab-df-generate {
        background-color: #E8F0FE;
        border: none;
        border-radius: 50%;
        cursor: pointer;
        display: none;
        fill: #1967D2;
        height: 32px;
        padding: 0 0 0 0;
        width: 32px;
      }

      .colab-df-generate:hover {
        background-color: #E2EBFA;
        box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
        fill: #174EA6;
      }

      [theme=dark] .colab-df-generate {
        background-color: #3B4455;
        fill: #D2E3FC;
      }

      [theme=dark] .colab-df-generate:hover {
        background-color: #434B5C;
        box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
        filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
        fill: #FFFFFF;
      }
    </style>
    <button class="colab-df-generate" onclick="generateWithVariable('df_cw8')" title="Generate code using this dataframe." style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewbox="0 0 24 24" width="24px">
    <path d="M7,19H8.4L18.45,9,17,7.55,7,17.6ZM5,21V16.75L18.45,3.32a2,2,0,0,1,2.83,0l1.4,1.43a1.91,1.91,0,0,1,.58,1.4,1.91,1.91,0,0,1-.58,1.4L9.25,21ZM18.45,9,17,7.55Zm-12,3A5.31,5.31,0,0,0,4.9,8.1,5.31,5.31,0,0,0,1,6.5,5.31,5.31,0,0,0,4.9,4.9,5.31,5.31,0,0,0,6.5,1,5.31,5.31,0,0,0,8.1,4.9,5.31,5.31,0,0,0,12,6.5,5.46,5.46,0,0,0,6.5,12Z"></path>
  </svg>
    </button>
    <script>
      (() => {
      const buttonEl =
        document.querySelector('#id_60b2f760-2744-4752-a5c4-10a766ed89f2 button.colab-df-generate');
      buttonEl.style.display =
        google.colab.kernel.accessAllowed ? 'block' : 'none';

      buttonEl.onclick = () => {
        google.colab.notebook.generateWithVariable('df_cw8');
      }
      })();
    </script>
  </div>

    </div>
  </div>
</div>
</div>
<div id="cell-65" class="cell" data-outputid="4302ec32-4fe6-4a1c-9fdc-f010657a336d" data-execution_count="18">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>thw <span class="op">=</span> [<span class="st">'temp'</span>,<span class="st">'hum'</span>,<span class="st">'windspeed'</span>]</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>df_thw <span class="op">=</span> df_cw8[df_cw8[<span class="st">'features'</span>].isin(thw)]</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>plt.errorbar(df_thw[<span class="st">'features'</span>], df_thw[<span class="st">'est'</span>],</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>             yerr <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> df_thw[<span class="st">'std_error'</span>], fmt <span class="op">=</span> <span class="st">'o'</span>, capsize <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Features"</span>)</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Coefficient Estimate"</span>)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Coefficient Estimates (Model_d)"</span>)</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)  <span class="co"># Add horizontal line at 0</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-28-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-66" class="cell" data-outputid="f53c3b6f-085d-42c3-bb39-3e37724b31a5" data-execution_count="19">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>months <span class="op">=</span> []</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">13</span>):</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  var <span class="op">=</span> <span class="ss">f'month_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  months.append(var)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>df_m <span class="op">=</span> df_cw8[df_cw8[<span class="st">'features'</span>].isin(months)]</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>plt.errorbar(df_m[<span class="st">'features'</span>], df_m[<span class="st">'est'</span>],</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>             yerr <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> df_m[<span class="st">'std_error'</span>], fmt <span class="op">=</span> <span class="st">'o'</span>, capsize <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Features"</span>)</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Coefficient Estimate"</span>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Coefficient Estimates (Model_d)"</span>)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)  <span class="co"># Add horizontal line at 0</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-67" class="cell" data-outputid="2faefa7f-8275-4be5-ba0f-6e81ee1b2ac0" data-execution_count="20">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>hrs <span class="op">=</span> []</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">24</span>):</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  hrs.append(<span class="ss">f'hr_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>df_h <span class="op">=</span> df_cw8[df_cw8[<span class="st">'features'</span>].isin(hrs)]</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>plt.errorbar(df_h[<span class="st">'features'</span>], df_h[<span class="st">'est'</span>],</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>             yerr <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> df_h[<span class="st">'std_error'</span>], fmt <span class="op">=</span> <span class="st">'o'</span>, capsize <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Features"</span>)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Coefficient Estimate"</span>)</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Coefficient Estimates (Model_d)"</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)  <span class="co"># Add horizontal line at 0</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-68" class="cell" data-outputid="7cad2b99-1433-4bdf-c749-3ff0bfed6814" data-execution_count="21">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>day <span class="op">=</span> [<span class="st">'monday'</span>, <span class="st">'tuesday'</span>,<span class="st">'wednesday'</span>, <span class="st">'thursday'</span>, <span class="st">'friday'</span>, <span class="st">'saturday'</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>wkd <span class="op">=</span> []</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> day:</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  wkd.append(<span class="ss">f'wkday_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>df_d <span class="op">=</span> df_cw8[df_cw8[<span class="st">'features'</span>].isin(wkd)]</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>plt.errorbar(df_d[<span class="st">'features'</span>], df_d[<span class="st">'est'</span>],</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>             yerr <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> df_d[<span class="st">'std_error'</span>], fmt <span class="op">=</span> <span class="st">'o'</span>, capsize <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Features"</span>)</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Coefficient Estimate"</span>)</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Coefficient Estimates (Model_d)"</span>)</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)  <span class="co"># Add horizontal line at 0</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-31-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-69" class="cell" data-outputid="f05d051e-a231-4e83-c7f3-c37cfd7374b3" data-execution_count="22">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>seasons <span class="op">=</span> [<span class="st">'summer'</span>, <span class="st">'fall'</span>, <span class="st">'winter'</span>]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>sn <span class="op">=</span> []</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> seasons:</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  sn.append(<span class="ss">f'seasons_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>df_s <span class="op">=</span> df_cw8[df_cw8[<span class="st">'features'</span>].isin(sn)]</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>plt.errorbar(df_s[<span class="st">'features'</span>], df_s[<span class="st">'est'</span>],</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>             yerr <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> df_s[<span class="st">'std_error'</span>], fmt <span class="op">=</span> <span class="st">'o'</span>, capsize <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Features"</span>)</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Coefficient Estimate"</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Coefficient Estimates (Model_d)"</span>)</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)  <span class="co"># Add horizontal line at 0</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-70" class="cell" data-outputid="ba94ef78-bf24-4dec-8378-fac5381a3d9f" data-execution_count="23">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>excess <span class="op">=</span> thw <span class="op">+</span> months <span class="op">+</span> hrs <span class="op">+</span> wkd <span class="op">+</span> sn <span class="op">+</span> [<span class="st">'year_2012'</span>, <span class="st">'holiday_1'</span>]</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>df_w <span class="op">=</span> df_cw8[<span class="op">~</span>df_cw8[<span class="st">'features'</span>].isin(excess)]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>plt.errorbar(df_w[<span class="st">'features'</span>], df_w[<span class="st">'est'</span>],</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>             yerr <span class="op">=</span> <span class="fl">1.96</span> <span class="op">*</span> df_w[<span class="st">'std_error'</span>], fmt <span class="op">=</span> <span class="st">'o'</span>, capsize <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Features"</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Coefficient Estimate"</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Coefficient Estimates (Model_d)"</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)  <span class="co"># Add horizontal line at 0</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-33-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="q8" class="level2">
<h2 class="anchored" data-anchor-id="q8">Q8</h2>
<div id="cell-72" class="cell" data-outputid="fc1ddf89-66eb-496c-bff0-1f5032c3992f" data-execution_count="24">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm  <span class="co"># for lowess smoothing</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> dtest2.select([<span class="st">"prediction"</span>, <span class="st">"cnt"</span>]).toPandas()</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Pred and actual following fitting data to model, on test set specifically</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"residual"</span>] <span class="op">=</span> df[<span class="st">"cnt"</span>] <span class="op">-</span> df[<span class="st">"prediction"</span>]</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>plt.scatter(df[<span class="st">"prediction"</span>], df[<span class="st">"residual"</span>], alpha<span class="op">=</span><span class="fl">0.2</span>, color<span class="op">=</span><span class="st">"darkgray"</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Use lowess smoothing for the trend line</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>smoothed <span class="op">=</span> sm.nonparametric.lowess(df[<span class="st">"residual"</span>], df[<span class="st">"prediction"</span>])</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>plt.plot(smoothed[:, <span class="dv">0</span>], smoothed[:, <span class="dv">1</span>], color<span class="op">=</span><span class="st">"darkblue"</span>)</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Perfect prediction line</span></span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   A horizontal line at residual = 0</span></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>plt.axhline(y<span class="op">=</span><span class="dv">0</span>, color<span class="op">=</span><span class="st">"red"</span>, linestyle<span class="op">=</span><span class="st">"--"</span>)</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Labeling</span></span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Predicted sale.price (Model 2)"</span>)</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Residuals"</span>)</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Residual Plot for Model 2"</span>)</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-34-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="q9" class="level2">
<h2 class="anchored" data-anchor-id="q9">Q9</h2>
<div id="cell-74" class="cell" data-outputid="6fc04a7b-ca49-47dd-a641-3fdc25c425e9" data-execution_count="25">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a histogram</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>dfpd <span class="op">=</span>bikeshare.select([<span class="st">"cnt"</span>]).toPandas()</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>sns.histplot(dfpd[<span class="st">"cnt"</span>], bins<span class="op">=</span><span class="dv">10</span>, kde<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-75" class="cell" data-outputid="0b67d31f-777d-4177-bf13-072a8c8662f8" data-execution_count="26">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>dfpd[<span class="st">'log_cnt'</span>] <span class="op">=</span> np.log(dfpd[<span class="st">'cnt'</span>])</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>sns.histplot(dfpd[<span class="st">"log_cnt"</span>], bins<span class="op">=</span><span class="dv">10</span>, kde<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="danl_320_lec_linreg_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="q10" class="level2">
<h2 class="anchored" data-anchor-id="q10">Q10</h2>
<div id="cell-77" class="cell" data-outputid="c4b65003-95e7-40fb-cced-2927fa1b6ad4" data-execution_count="36">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>bikeshare <span class="op">=</span> pd.read_csv(<span class="st">'https://bcdanl.github.io/data/bikeshare_cleaned.csv'</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>bikeshare <span class="op">=</span> spark.createDataFrame(bikeshare)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>bikeshare.show()</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>bikeshare <span class="op">=</span> bikeshare.withColumn(<span class="st">"log_cnt"</span>,</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                                 log(bikeshare[<span class="st">'cnt'</span>]))</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>bikeshare <span class="op">=</span> bikeshare.withColumn(<span class="st">"gp"</span>, rand(seed<span class="op">=</span><span class="dv">123</span>)) <span class="co"># seed is set for replication</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>dtrain, dtest <span class="op">=</span> bikeshare.randomSplit([<span class="fl">0.6</span>, <span class="fl">0.4</span>], seed <span class="op">=</span> <span class="dv">123</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>dummy_cols_year, ref_cat_year <span class="op">=</span> add_dummy_variables(<span class="st">'year'</span>, <span class="dv">0</span>)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>dummy_cols_month, ref_cat_month <span class="op">=</span> add_dummy_variables(<span class="st">'month'</span>, <span class="dv">0</span>)</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>dummy_cols_hr, ref_cat_hr <span class="op">=</span> add_dummy_variables(<span class="st">'hr'</span>, <span class="dv">0</span>)</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>dummy_cols_hol, ref_cat_hol <span class="op">=</span> add_dummy_variables(<span class="st">'holiday'</span>, <span class="dv">0</span>)</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>dummy_cols_wc, ref_cat_wc <span class="op">=</span> add_dummy_variables(<span class="st">'weather_cond'</span>, <span class="dv">0</span>)</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>custom_order_wkday <span class="op">=</span> [<span class="st">'sunday'</span>, <span class="st">'monday'</span>, <span class="st">'tuesday'</span>, <span class="st">'wednesday'</span>, <span class="st">'thursday'</span>, <span class="st">'friday'</span>, <span class="st">'saturday'</span>]</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>dummy_cols_day, ref_cat_day <span class="op">=</span> add_dummy_variables(<span class="st">'wkday'</span>, reference_level<span class="op">=</span><span class="dv">0</span>, category_order <span class="op">=</span> custom_order_wkday)</span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>custom_order_season <span class="op">=</span> [<span class="st">'spring'</span>, <span class="st">'summer'</span>, <span class="st">'fall'</span>, <span class="st">'winter'</span>]</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>dummy_cols_season, ref_cat_season <span class="op">=</span> add_dummy_variables(<span class="st">'seasons'</span>, reference_level<span class="op">=</span><span class="dv">0</span>, category_order <span class="op">=</span> custom_order_season)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>cont_cols <span class="op">=</span> [<span class="st">'temp'</span>, <span class="st">'hum'</span>, <span class="st">'windspeed'</span>]</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> cont_cols <span class="op">+</span> dummy_cols_year <span class="op">+</span> dummy_cols_month <span class="op">+</span> dummy_cols_hr <span class="op">+</span> dummy_cols_hol <span class="op">+</span> dummy_cols_wc <span class="op">+</span> dummy_cols_day <span class="op">+</span> dummy_cols_season</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---+----+-----+----+---+--------+-------+-------+--------------------+------------------+-----------------+------------------+
|cnt|year|month|date| hr|   wkday|holiday|seasons|        weather_cond|              temp|              hum|         windspeed|
+---+----+-----+----+---+--------+-------+-------+--------------------+------------------+-----------------+------------------+
| 16|2011|    1|   1|  0|saturday|      0| spring| Clear or Few Cloudy| -1.33460918694128|0.947345243330896|  -1.5538438052971|
| 40|2011|    1|   1|  1|saturday|      0| spring| Clear or Few Cloudy| -1.43847500990342|0.895512927978679|  -1.5538438052971|
| 32|2011|    1|   1|  2|saturday|      0| spring| Clear or Few Cloudy| -1.43847500990342|0.895512927978679|  -1.5538438052971|
| 13|2011|    1|   1|  3|saturday|      0| spring| Clear or Few Cloudy| -1.33460918694128|0.636351351217591|  -1.5538438052971|
|  1|2011|    1|   1|  4|saturday|      0| spring| Clear or Few Cloudy| -1.33460918694128|0.636351351217591|  -1.5538438052971|
|  1|2011|    1|   1|  5|saturday|      0| spring|      Mist or Cloudy| -1.33460918694128|0.636351351217591|-0.821460017517193|
|  2|2011|    1|   1|  6|saturday|      0| spring| Clear or Few Cloudy| -1.43847500990342|0.895512927978679|  -1.5538438052971|
|  3|2011|    1|   1|  7|saturday|      0| spring| Clear or Few Cloudy| -1.54234083286556| 1.20650682009198|  -1.5538438052971|
|  8|2011|    1|   1|  8|saturday|      0| spring| Clear or Few Cloudy| -1.33460918694128|0.636351351217591|  -1.5538438052971|
| 14|2011|    1|   1|  9|saturday|      0| spring| Clear or Few Cloudy|-0.919145895092722|0.688183666569809|  -1.5538438052971|
| 36|2011|    1|   1| 10|saturday|      0| spring| Clear or Few Cloudy|-0.607548426206302|0.688183666569809| 0.519881272378821|
| 56|2011|    1|   1| 11|saturday|      0| spring| Clear or Few Cloudy|-0.711414249168442|0.947345243330896| 0.764281665845554|
| 84|2011|    1|   1| 12|saturday|      0| spring| Clear or Few Cloudy|-0.399816780282022|0.740015981922026| 0.764281665845554|
| 94|2011|    1|   1| 13|saturday|      0| spring|      Mist or Cloudy|-0.192085134357741|0.480854405160939| 0.886073166268775|
|106|2011|    1|   1| 14|saturday|      0| spring|      Mist or Cloudy|-0.192085134357741|0.480854405160939| 0.764281665845554|
|110|2011|    1|   1| 15|saturday|      0| spring|      Mist or Cloudy|-0.295950957319881|0.740015981922026| 0.886073166268775|
| 93|2011|    1|   1| 16|saturday|      0| spring|      Mist or Cloudy|-0.399816780282022|0.999177558683113| 0.886073166268775|
| 67|2011|    1|   1| 17|saturday|      0| spring|      Mist or Cloudy|-0.295950957319881|0.999177558683113| 0.764281665845554|
| 35|2011|    1|   1| 18|saturday|      0| spring|Light Snow or Lig...|-0.399816780282022| 1.31017145079642| 0.519881272378821|
| 37|2011|    1|   1| 19|saturday|      0| spring|Light Snow or Lig...|-0.399816780282022| 1.31017145079642| 0.519881272378821|
+---+----+-----+----+---+--------+-------+-------+--------------------+------------------+-----------------+------------------+
only showing top 20 rows

Reference category (dummy omitted): 2011
Reference category (dummy omitted): 1
Reference category (dummy omitted): 0
Reference category (dummy omitted): 0
Reference category (dummy omitted): Clear or Few Cloudy
Reference category (dummy omitted): sunday
Reference category (dummy omitted): spring</code></pre>
</div>
</div>
<div id="cell-78" class="cell" data-outputid="27eaf7e9-9f82-4430-9a86-acc696fc3ff6" data-execution_count="37">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>assembler_lg <span class="op">=</span> VectorAssembler(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>                    inputCols<span class="op">=</span> features,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>                    outputCol<span class="op">=</span><span class="st">"predictors"</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>dtrainlg <span class="op">=</span> assembler_lg.transform(dtrain)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>dtestlg  <span class="op">=</span> assembler_lg.transform(dtest)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>model_lg <span class="op">=</span> LinearRegression(</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>                featuresCol<span class="op">=</span><span class="st">"predictors"</span>,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>                labelCol<span class="op">=</span><span class="st">"log_cnt"</span>).fit(dtrainlg)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>dtestlg <span class="op">=</span> model_lg.transform(dtestlg)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(regression_table(model_lg, assembler_lg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+---------------------------------------------+--------+------+------------+---------+--------------+--------------+
| Metric                                      |  Value | Sig. | Std. Error | p-value | 95% CI Lower | 95% CI Upper |
+---------------------------------------------+--------+------+------------+---------+--------------+--------------+
| Beta: temp                                  |  0.276 | ***  |      0.009 |   0.000 |        0.259 |        0.292 |
| Beta: hum                                   | -0.048 | ***  |      0.007 |   0.000 |       -0.061 |       -0.035 |
| Beta: windspeed                             | -0.030 | ***  |      0.012 |   0.000 |       -0.054 |       -0.005 |
| Beta: year_2012                             |  0.482 | ***  |      0.031 |   0.000 |        0.421 |        0.543 |
| Beta: month_2                               |  0.126 | ***  |      0.035 |   0.000 |        0.057 |        0.194 |
| Beta: month_3                               |  0.156 | ***  |      0.052 |   0.000 |        0.054 |        0.258 |
| Beta: month_4                               |  0.104 |  **  |      0.055 |   0.044 |       -0.004 |        0.213 |
| Beta: month_5                               |  0.196 | ***  |      0.057 |   0.000 |        0.084 |        0.307 |
| Beta: month_6                               |  0.101 |  *   |      0.064 |   0.078 |       -0.025 |        0.226 |
| Beta: month_7                               | -0.081 |      |      0.062 |   0.207 |       -0.203 |        0.041 |
| Beta: month_8                               |  0.034 |      |      0.055 |   0.590 |       -0.075 |        0.142 |
| Beta: month_9                               |  0.099 |  *   |      0.051 |   0.074 |       -0.001 |        0.200 |
| Beta: month_10                              | -0.015 |      |      0.050 |   0.769 |       -0.112 |        0.082 |
| Beta: month_11                              | -0.076 |      |      0.039 |   0.125 |       -0.153 |        0.001 |
| Beta: month_12                              | -0.075 |  *   |      0.042 |   0.057 |       -0.157 |        0.008 |
| Beta: hr_1                                  | -0.602 | ***  |      0.042 |   0.000 |       -0.684 |       -0.520 |
| Beta: hr_2                                  | -1.180 | ***  |      0.043 |   0.000 |       -1.265 |       -1.096 |
| Beta: hr_3                                  | -1.734 | ***  |      0.043 |   0.000 |       -1.818 |       -1.651 |
| Beta: hr_4                                  | -2.005 | ***  |      0.042 |   0.000 |       -2.087 |       -1.923 |
| Beta: hr_5                                  | -0.948 | ***  |      0.042 |   0.000 |       -1.031 |       -0.865 |
| Beta: hr_6                                  |  0.260 | ***  |      0.042 |   0.000 |        0.178 |        0.342 |
| Beta: hr_7                                  |  1.319 | ***  |      0.042 |   0.000 |        1.237 |        1.400 |
| Beta: hr_8                                  |  1.931 | ***  |      0.042 |   0.000 |        1.848 |        2.014 |
| Beta: hr_9                                  |  1.601 | ***  |      0.042 |   0.000 |        1.519 |        1.683 |
| Beta: hr_10                                 |  1.290 | ***  |      0.042 |   0.000 |        1.207 |        1.373 |
| Beta: hr_11                                 |  1.383 | ***  |      0.042 |   0.000 |        1.300 |        1.466 |
| Beta: hr_12                                 |  1.569 | ***  |      0.044 |   0.000 |        1.483 |        1.655 |
| Beta: hr_13                                 |  1.529 | ***  |      0.044 |   0.000 |        1.443 |        1.615 |
| Beta: hr_14                                 |  1.446 | ***  |      0.043 |   0.000 |        1.361 |        1.532 |
| Beta: hr_15                                 |  1.534 | ***  |      0.043 |   0.000 |        1.449 |        1.619 |
| Beta: hr_16                                 |  1.787 | ***  |      0.043 |   0.000 |        1.703 |        1.872 |
| Beta: hr_17                                 |  2.161 | ***  |      0.042 |   0.000 |        2.078 |        2.244 |
| Beta: hr_18                                 |  2.078 | ***  |      0.042 |   0.000 |        1.996 |        2.161 |
| Beta: hr_19                                 |  1.787 | ***  |      0.043 |   0.000 |        1.704 |        1.871 |
| Beta: hr_20                                 |  1.498 | ***  |      0.042 |   0.000 |        1.416 |        1.580 |
| Beta: hr_21                                 |  1.284 | ***  |      0.042 |   0.000 |        1.201 |        1.366 |
| Beta: hr_22                                 |  1.003 | ***  |      0.042 |   0.000 |        0.921 |        1.085 |
| Beta: hr_23                                 |  0.633 | ***  |      0.038 |   0.000 |        0.558 |        0.708 |
| Beta: holiday_1                             | -0.160 | ***  |      0.025 |   0.000 |       -0.210 |       -0.111 |
| Beta: weather_cond_Light_Snow_or_Light_Rain | -0.599 | ***  |      0.015 |   0.000 |       -0.629 |       -0.569 |
| Beta: weather_cond_Mist_or_Cloudy           | -0.040 | ***  |      0.024 |   0.010 |       -0.086 |        0.007 |
| Beta: wkday_monday                          | -0.018 |      |      0.023 |   0.452 |       -0.063 |        0.028 |
| Beta: wkday_tuesday                         | -0.036 |      |      0.023 |   0.124 |       -0.081 |        0.010 |
| Beta: wkday_wednesday                       | -0.032 |      |      0.023 |   0.166 |       -0.077 |        0.013 |
| Beta: wkday_thursday                        |  0.018 |      |      0.023 |   0.432 |       -0.027 |        0.063 |
| Beta: wkday_friday                          |  0.119 | ***  |      0.023 |   0.000 |        0.074 |        0.164 |
| Beta: wkday_saturday                        |  0.130 | ***  |      0.038 |   0.000 |        0.055 |        0.204 |
| Beta: seasons_summer                        |  0.346 | ***  |      0.045 |   0.000 |        0.257 |        0.435 |
| Beta: seasons_fall                          |  0.407 | ***  |      0.038 |   0.000 |        0.331 |        0.482 |
| Beta: seasons_winter                        |  0.657 | ***  |      0.046 |   0.000 |        0.568 |        0.747 |
| Intercept                                   |  3.100 | ***  |      0.014 |   0.000 |        3.072 |        3.129 |
--------------------------------------------------------------------------------------------------------------------
| Observations                                | 10,375 |      |            |         |              |              |
| R²                                          |  0.825 |      |            |         |              |              |
| RMSE                                        |  0.623 |      |            |         |              |              |
+---------------------------------------------+--------+------+------------+---------+--------------+--------------+</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script type="text/javascript" src="links.js"></script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Powered with GitHub, Quarto and Rstudio<br>© Daniel Noone, 2023</p>
</div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>